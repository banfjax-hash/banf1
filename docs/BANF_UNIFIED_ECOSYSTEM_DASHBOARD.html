<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>BANF — Unified Development Ecosystem Dashboard</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">
<style>
/* ═══════ DESIGN TOKENS ═══════ */
:root{
  --bg:#060a10;--bg2:#0b1120;--panel:#111827;--card:#0f172a;
  --line:#1e293b;--line2:#334155;--text:#e2e8f0;--muted:#94a3b8;--dim:#475569;
  --accent:#f97316;--accent2:#ea580c;--red:#ef4444;--green:#22c55e;--blue:#3b82f6;
  --purple:#a855f7;--cyan:#06b6d4;--yellow:#eab308;--pink:#ec4899;--lime:#84cc16;
  --teal:#14b8a6;--indigo:#6366f1;
  --glow:rgba(249,115,22,.08);--glow-b:rgba(59,130,246,.08);
  --radius:12px;--radius-sm:8px;
}
*{box-sizing:border-box}
body{margin:0;background:var(--bg);color:var(--text);font-family:'Segoe UI',system-ui,-apple-system,sans-serif;line-height:1.5;overflow-x:hidden}

/* ═══════ SIDEBAR ═══════ */
.sidebar{position:fixed;left:0;top:0;bottom:0;width:62px;background:#070b14;border-right:1px solid var(--line);z-index:1000;display:flex;flex-direction:column;align-items:center;padding:12px 0;gap:4px;transition:width .2s}
.sidebar .logo{width:38px;height:38px;border-radius:10px;background:linear-gradient(135deg,#f97316,#ea580c);display:flex;align-items:center;justify-content:center;font-weight:800;font-size:.9rem;color:#fff;margin-bottom:14px}
.sidebar .nav-item{width:42px;height:42px;border-radius:10px;display:flex;align-items:center;justify-content:center;color:var(--muted);cursor:pointer;font-size:1rem;position:relative;transition:all .15s}
.sidebar .nav-item:hover{background:rgba(249,115,22,.1);color:var(--accent)}
.sidebar .nav-item.active{background:rgba(249,115,22,.15);color:var(--accent);box-shadow:inset 3px 0 0 var(--accent)}
.sidebar .nav-item .tip{position:absolute;left:56px;background:#1e293b;color:#fff;padding:4px 10px;border-radius:6px;font-size:.72rem;white-space:nowrap;pointer-events:none;opacity:0;transition:opacity .15s}
.sidebar .nav-item:hover .tip{opacity:1}
.sidebar .spacer{flex:1}
.sidebar .nav-divider{width:36px;border-top:1px solid rgba(71,85,105,.4);margin:4px 0 2px;position:relative}
.sidebar .nav-divider .div-tip{position:absolute;left:56px;top:-8px;background:rgba(30,41,59,.95);color:var(--dim);padding:2px 8px;border-radius:4px;font-size:.58rem;white-space:nowrap;pointer-events:none;opacity:0;transition:opacity .15s;text-transform:uppercase;letter-spacing:.5px;font-weight:700}
.sidebar .nav-divider:hover .div-tip{opacity:1}

/* ═══════ MAIN ═══════ */
.main{margin-left:62px;min-height:100vh}
.top-bar{background:#070b14;border-bottom:1px solid var(--line);padding:12px 28px;display:flex;align-items:center;justify-content:space-between;position:sticky;top:0;z-index:500;backdrop-filter:blur(12px)}
.top-bar h1{font-size:1.1rem;font-weight:700;margin:0;background:linear-gradient(90deg,#f97316,#fb923c);-webkit-background-clip:text;-webkit-text-fill-color:transparent}
.top-bar .meta{color:var(--muted);font-size:.78rem;display:flex;align-items:center;gap:14px}
.top-bar .status-dot{width:8px;height:8px;border-radius:50%;display:inline-block}
.top-bar .status-dot.ok{background:var(--green);box-shadow:0 0 6px var(--green)}
.top-bar .status-dot.err{background:var(--red);box-shadow:0 0 6px var(--red)}
.top-bar .status-dot.loading{background:var(--yellow);animation:pulse 1s infinite}
@keyframes pulse{0%,100%{opacity:1}50%{opacity:.3}}

.content{padding:20px 28px 40px}

/* ═══════ SECTIONS ═══════ */
.section{display:none}.section.active{display:block;animation:fadeIn .25s ease}
@keyframes fadeIn{from{opacity:0;transform:translateY(6px)}to{opacity:1;transform:translateY(0)}}

/* ═══════ CARDS ═══════ */
.card-d{background:var(--card);border:1px solid var(--line);border-radius:var(--radius);padding:20px;margin-bottom:16px}
.card-d h2{font-size:.95rem;font-weight:700;color:#fff;margin:0 0 14px;display:flex;align-items:center;gap:8px}
.card-d h2 i{color:var(--accent);font-size:.85rem}
.card-d h3{font-size:.84rem;color:var(--accent);margin:12px 0 6px}

/* ═══════ KPI GRID ═══════ */
.kpi-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(155px,1fr));gap:12px;margin-bottom:16px}
.kpi{background:var(--bg2);border:1px solid var(--line);border-radius:var(--radius-sm);padding:16px;text-align:center;transition:all .2s;cursor:default}
.kpi:hover{border-color:var(--accent);transform:translateY(-2px)}
.kpi .v{font-size:1.6rem;font-weight:800;color:#fff;line-height:1.1}
.kpi .k{font-size:.72rem;color:var(--muted);margin-top:4px;text-transform:uppercase;letter-spacing:.4px}
.kpi.green .v{color:var(--green)} .kpi.red .v{color:var(--red)} .kpi.blue .v{color:var(--blue)} .kpi.orange .v{color:var(--accent)} .kpi.purple .v{color:var(--purple)} .kpi.cyan .v{color:var(--cyan)} .kpi.yellow .v{color:var(--yellow)} .kpi.pink .v{color:var(--pink)}

/* ═══════ TABLE ═══════ */
.t{color:var(--text);width:100%;border-collapse:collapse;font-size:.8rem}
.t thead th{background:rgba(249,115,22,.06);color:#ffd7c2;padding:8px 10px;border-bottom:1px solid var(--line2);font-weight:600;text-align:left;font-size:.75rem;text-transform:uppercase;letter-spacing:.3px;white-space:nowrap}
.t td{padding:7px 10px;border-bottom:1px solid rgba(30,41,59,.6);vertical-align:top}
.t tbody tr:hover td{background:rgba(249,115,22,.03)}

/* ═══════ BADGES ═══════ */
.badge-s{display:inline-block;padding:2px 8px;border-radius:999px;font-size:.68rem;font-weight:600}
.badge-green{background:rgba(34,197,94,.15);color:var(--green)}
.badge-red{background:rgba(239,68,68,.15);color:var(--red)}
.badge-yellow{background:rgba(234,179,8,.15);color:var(--yellow)}
.badge-blue{background:rgba(59,130,246,.15);color:var(--blue)}
.badge-purple{background:rgba(168,85,247,.15);color:var(--purple)}
.badge-orange{background:rgba(249,115,22,.15);color:var(--accent)}
.badge-cyan{background:rgba(6,182,212,.15);color:var(--cyan)}
.badge-dim{background:rgba(71,85,105,.2);color:var(--dim)}

/* ═══════ PIPELINE ═══════ */
.pipeline{display:flex;gap:4px;margin:16px 0;flex-wrap:wrap}
.pipe-step{flex:1;min-width:115px;padding:14px 10px;text-align:center;border-radius:var(--radius-sm);position:relative}
.pipe-step .pipe-icon{font-size:1.3rem;margin-bottom:4px}
.pipe-step h6{font-size:.76rem;margin:0;font-weight:700}
.pipe-step small{font-size:.66rem;color:var(--muted)}
.pipe-arrow{display:flex;align-items:center;color:var(--line2);font-size:.9rem}

/* Step colors */
.ps-req{background:rgba(59,130,246,.1);border:1px solid rgba(59,130,246,.25)}.ps-req .pipe-icon{color:var(--blue)}
.ps-des{background:rgba(168,85,247,.1);border:1px solid rgba(168,85,247,.25)}.ps-des .pipe-icon{color:var(--purple)}
.ps-dev{background:rgba(34,197,94,.1);border:1px solid rgba(34,197,94,.25)}.ps-dev .pipe-icon{color:var(--green)}
.ps-tst{background:rgba(234,179,8,.1);border:1px solid rgba(234,179,8,.25)}.ps-tst .pipe-icon{color:var(--yellow)}
.ps-dpl{background:rgba(249,115,22,.1);border:1px solid rgba(249,115,22,.25)}.ps-dpl .pipe-icon{color:var(--accent)}
.ps-ops{background:rgba(239,68,68,.1);border:1px solid rgba(239,68,68,.25)}.ps-ops .pipe-icon{color:var(--red)}
.ps-mlo{background:rgba(6,182,212,.1);border:1px solid rgba(6,182,212,.25)}.ps-mlo .pipe-icon{color:var(--cyan)}

/* ═══════ AGENT CARD ═══════ */
.agent-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(260px,1fr));gap:12px}
.agent-card{background:var(--bg2);border:1px solid var(--line);border-radius:var(--radius-sm);padding:14px;transition:all .2s}
.agent-card:hover{border-color:var(--accent);transform:translateY(-1px)}
.agent-card .a-hdr{display:flex;align-items:center;gap:10px;margin-bottom:8px}
.agent-card .a-icon{width:36px;height:36px;border-radius:10px;display:flex;align-items:center;justify-content:center;font-size:1rem}
.agent-card .a-name{font-weight:700;font-size:.84rem}
.agent-card .a-stage{font-size:.68rem;color:var(--muted)}
.agent-card .a-caps{display:flex;flex-wrap:wrap;gap:3px;margin-top:6px}
.agent-card .a-cap{font-size:.64rem;padding:2px 6px;border-radius:4px;background:rgba(255,255,255,.05);color:var(--muted)}
.agent-card .a-gate{font-size:.7rem;color:var(--yellow);margin-top:6px}

/* ═══════ ENDPOINT LIST ═══════ */
.ep-group{margin-bottom:12px}
.ep-group-hdr{display:flex;align-items:center;gap:8px;padding:8px 12px;background:rgba(249,115,22,.04);border:1px solid var(--line);border-radius:var(--radius-sm);cursor:pointer;user-select:none}
.ep-group-hdr:hover{background:rgba(249,115,22,.08)}
.ep-group-hdr .ep-name{font-weight:700;font-size:.82rem;flex:1}
.ep-group-hdr .ep-count{font-size:.72rem;color:var(--muted)}
.ep-group-hdr .ep-arrow{transition:transform .2s}
.ep-group-hdr.open .ep-arrow{transform:rotate(90deg)}
.ep-body{display:none;padding:6px 0 6px 12px}
.ep-body.open{display:block}
.ep-item{font-size:.76rem;padding:3px 0;color:var(--muted);font-family:Consolas,Monaco,monospace}
.ep-item .ep-method{font-weight:700;display:inline-block;width:36px}
.ep-item .ep-method.get{color:var(--green)}.ep-item .ep-method.post{color:var(--blue)}

/* ═══════ COLLECTION SCHEMA ═══════ */
.coll-card{background:var(--bg2);border:1px solid var(--line);border-radius:var(--radius-sm);padding:14px;margin-bottom:10px}
.coll-card h4{font-size:.84rem;color:var(--accent);margin:0 0 6px;font-weight:700}
.coll-card .coll-desc{font-size:.74rem;color:var(--muted);margin-bottom:8px}
.coll-card .coll-fields{display:flex;flex-wrap:wrap;gap:4px}
.coll-card .coll-field{font-size:.68rem;padding:2px 7px;border-radius:4px;background:rgba(255,255,255,.04);color:var(--dim);font-family:Consolas,monospace}

/* ═══════ SPRINT TRACKER ═══════ */
.sprint-track{display:flex;gap:12px;overflow-x:auto;padding-bottom:8px}
.sprint-col{min-width:210px;background:var(--bg2);border:1px solid var(--line);border-radius:var(--radius-sm);padding:12px}
.sprint-col h5{font-size:.8rem;color:var(--accent);margin:0 0 8px;font-weight:700}
.sprint-item{font-size:.74rem;padding:6px 8px;background:rgba(255,255,255,.03);border:1px solid var(--line);border-radius:6px;margin-bottom:4px}
.sprint-item .si-id{color:var(--blue);font-weight:600}
.sprint-item .si-title{color:var(--text)}
.sprint-item .si-pts{float:right;color:var(--yellow);font-weight:700}

/* ═══════ ROLE TABS ═══════ */
.role-tabs{display:flex;gap:4px;margin-bottom:14px;flex-wrap:wrap}
.role-tab{padding:6px 14px;border-radius:8px;font-size:.78rem;cursor:pointer;border:1px solid var(--line);color:var(--muted);transition:.15s}
.role-tab:hover{color:var(--text);border-color:var(--line2)}
.role-tab.active{background:rgba(249,115,22,.12);border-color:var(--accent);color:var(--accent)}
.role-panel{display:none}.role-panel.active{display:block}
.widget-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(230px,1fr));gap:10px}
.widget{background:var(--bg2);border:1px solid var(--line);border-radius:var(--radius-sm);padding:14px}
.widget h6{font-size:.8rem;color:var(--accent);margin:0 0 4px}
.widget p{font-size:.74rem;color:var(--muted);margin:0}

/* ═══════ QUICK LINKS ═══════ */
.link-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(240px,1fr));gap:10px}
.link-card{display:flex;align-items:center;gap:12px;background:var(--bg2);border:1px solid var(--line);border-radius:var(--radius-sm);padding:12px;text-decoration:none;color:var(--text);transition:.2s}
.link-card:hover{border-color:var(--accent);transform:translateY(-1px);color:var(--text)}
.link-card .lc-icon{width:36px;height:36px;border-radius:8px;display:flex;align-items:center;justify-content:center;font-size:.9rem;flex-shrink:0}
.link-card .lc-title{font-weight:600;font-size:.82rem}
.link-card .lc-desc{font-size:.7rem;color:var(--muted)}

/* ═══════ OBSERVABILITY ═══════ */
.otel-tabs{display:flex;gap:4px;margin-bottom:14px}.otel-tab{padding:6px 14px;border-radius:8px;font-size:.78rem;cursor:pointer;border:1px solid var(--line);color:var(--muted);transition:.15s}.otel-tab:hover{color:var(--text);border-color:var(--line2)}.otel-tab.active{background:rgba(6,182,212,.12);border-color:var(--cyan);color:var(--cyan)}
.otel-panel{display:none}.otel-panel.active{display:block}
.log-entry{font-family:Consolas,monospace;font-size:.72rem;padding:4px 8px;border-bottom:1px solid rgba(30,41,59,.4);display:flex;gap:10px;align-items:baseline;transition:background .1s}.log-entry:hover{background:rgba(255,255,255,.02)}
.log-ts{color:var(--dim);min-width:80px;flex-shrink:0}.log-level{font-weight:700;min-width:42px;text-transform:uppercase;flex-shrink:0}.log-level.info{color:var(--cyan)}.log-level.warn{color:var(--yellow)}.log-level.error{color:var(--red)}.log-level.debug{color:var(--muted)}
.log-svc{color:var(--purple);min-width:100px;flex-shrink:0}.log-trace{color:var(--dim);min-width:70px;flex-shrink:0}.log-msg{color:var(--text);flex:1;word-break:break-all}
.metric-bar-row{display:flex;align-items:center;gap:8px;padding:4px 0;font-size:.76rem}.metric-bar-label{min-width:130px;color:var(--muted)}.metric-bar-track{flex:1;height:18px;background:var(--bg);border-radius:4px;overflow:hidden;position:relative}.metric-bar-fill{height:100%;border-radius:4px;transition:width .4s}.metric-bar-val{min-width:55px;text-align:right;font-weight:600;font-family:Consolas,monospace}
.trace-waterfall{position:relative;padding:8px 0}.trace-row{display:flex;align-items:center;gap:8px;padding:3px 0;font-size:.74rem}.trace-svc{min-width:120px;color:var(--muted);text-align:right}.trace-bar-area{flex:1;position:relative;height:20px}.trace-bar{position:absolute;height:14px;top:3px;border-radius:3px;display:flex;align-items:center;padding:0 6px;font-size:.65rem;color:#fff;font-weight:600;white-space:nowrap}
.trace-dur{min-width:55px;font-family:Consolas,monospace;font-size:.72rem;color:var(--dim)}
.alert-rule{display:flex;align-items:center;gap:12px;padding:8px 12px;background:var(--bg2);border:1px solid var(--line);border-radius:var(--radius-sm);margin-bottom:6px;font-size:.78rem}
.alert-sev{width:8px;height:8px;border-radius:50%;flex-shrink:0}.alert-sev.critical{background:var(--red);box-shadow:0 0 6px var(--red)}.alert-sev.warning{background:var(--yellow);box-shadow:0 0 6px var(--yellow)}.alert-sev.info{background:var(--cyan);box-shadow:0 0 4px var(--cyan)}
.alert-name{flex:1;font-weight:600}.alert-cond{color:var(--muted);font-family:Consolas,monospace;font-size:.72rem}.alert-status{font-size:.7rem}

/* ═══════ SYSTEM INTERNALS ═══════ */
.int-tabs{display:flex;gap:3px;margin-bottom:14px;flex-wrap:wrap}.int-tab{padding:5px 12px;border-radius:6px;font-size:.72rem;cursor:pointer;border:1px solid var(--line);color:var(--muted);transition:.15s}.int-tab:hover{color:var(--text);border-color:var(--line2)}.int-tab.active{background:rgba(132,204,22,.12);border-color:var(--lime);color:var(--lime)}
.int-panel{display:none}.int-panel.active{display:block}
.flow-diagram{display:flex;align-items:center;gap:4px;flex-wrap:wrap;margin:12px 0;padding:14px;background:var(--bg);border:1px solid var(--line);border-radius:var(--radius-sm)}
.flow-node{padding:8px 14px;border-radius:8px;font-size:.74rem;font-weight:600;text-align:center;min-width:90px;border:1px solid}.flow-node.input{background:rgba(59,130,246,.1);border-color:rgba(59,130,246,.3);color:var(--blue)}.flow-node.process{background:rgba(168,85,247,.1);border-color:rgba(168,85,247,.3);color:var(--purple)}.flow-node.store{background:rgba(34,197,94,.1);border-color:rgba(34,197,94,.3);color:var(--green)}.flow-node.output{background:rgba(249,115,22,.1);border-color:rgba(249,115,22,.3);color:var(--accent)}.flow-node.agent{background:rgba(6,182,212,.1);border-color:rgba(6,182,212,.3);color:var(--cyan)}
.flow-arrow{color:var(--line2);font-size:.8rem}
.data-model-mini{display:grid;grid-template-columns:repeat(auto-fill,minmax(180px,1fr));gap:8px;margin-top:10px}
.dm-card{background:var(--bg);border:1px solid var(--line);border-radius:6px;padding:10px}.dm-card h6{font-size:.76rem;color:var(--accent);margin:0 0 4px;font-weight:700}.dm-card ul{margin:0;padding:0 0 0 14px;font-size:.68rem;color:var(--muted);list-style:disc}

/* ═══════ EXPERT REVIEW ═══════ */
.expert-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(230px,1fr));gap:10px;margin-bottom:16px}
.expert-card{background:var(--bg2);border:1px solid var(--line);border-radius:var(--radius-sm);padding:14px;transition:all .2s}.expert-card:hover{border-color:var(--accent);transform:translateY(-1px)}
.expert-card .ex-hdr{display:flex;align-items:center;gap:10px;margin-bottom:8px}.expert-card .ex-icon{width:36px;height:36px;border-radius:10px;display:flex;align-items:center;justify-content:center;font-size:1rem}
.expert-card .ex-name{font-weight:700;font-size:.82rem}.expert-card .ex-role{font-size:.68rem;color:var(--muted)}.expert-card .ex-stats{display:flex;gap:8px;margin-top:8px;font-size:.68rem}.expert-card .ex-stat{color:var(--muted)}.expert-card .ex-stat strong{color:var(--text)}
.lg-flow{position:relative;padding:14px;background:var(--bg);border:1px solid var(--line);border-radius:var(--radius-sm);overflow-x:auto}
.lg-row{display:flex;align-items:center;gap:6px;margin-bottom:8px}.lg-node{padding:6px 12px;border-radius:6px;font-size:.72rem;font-weight:600;min-width:100px;text-align:center;border:2px solid;position:relative}
.lg-node.done{background:rgba(34,197,94,.1);border-color:var(--green);color:var(--green)}.lg-node.active{background:rgba(234,179,8,.1);border-color:var(--yellow);color:var(--yellow);animation:pulse 1.5s infinite}.lg-node.blocked{background:rgba(239,68,68,.1);border-color:var(--red);color:var(--red)}.lg-node.pending{background:rgba(71,85,105,.1);border-color:var(--dim);color:var(--dim)}
.lg-arrow{color:var(--line2);font-size:.7rem}.lg-meta{font-size:.64rem;color:var(--dim);margin-top:2px}
.audit-entry{display:flex;gap:10px;padding:8px 10px;border-bottom:1px solid rgba(30,41,59,.4);font-size:.76rem;align-items:flex-start}.audit-expert{min-width:90px;font-weight:600;flex-shrink:0}.audit-comment{flex:1;color:var(--muted)}.audit-status{flex-shrink:0}.audit-ts{min-width:70px;color:var(--dim);font-size:.68rem;text-align:right;flex-shrink:0}

.exp-section-tabs{display:flex;gap:3px;margin-bottom:12px;flex-wrap:wrap}
.exp-sec-tab{padding:4px 10px;border-radius:6px;font-size:.7rem;cursor:pointer;border:1px solid var(--line);color:var(--muted);transition:.15s}.exp-sec-tab:hover{color:var(--text)}.exp-sec-tab.active{background:rgba(236,72,153,.12);border-color:var(--pink);color:var(--pink)}
.exp-sec-panel{display:none}.exp-sec-panel.active{display:block}

/* ═══════ REQUIREMENTS & DOCS ═══════ */
.doc-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(260px,1fr));gap:10px}
.doc-card{background:var(--bg2);border:1px solid var(--line);border-radius:var(--radius-sm);padding:14px;transition:all .2s;text-decoration:none;color:var(--text);display:block}.doc-card:hover{border-color:var(--accent);transform:translateY(-1px);color:var(--text)}
.doc-card .dc-hdr{display:flex;align-items:center;gap:10px;margin-bottom:6px}.doc-card .dc-icon{width:34px;height:34px;border-radius:8px;display:flex;align-items:center;justify-content:center;font-size:.9rem;flex-shrink:0}
.doc-card .dc-title{font-weight:700;font-size:.82rem}.doc-card .dc-desc{font-size:.72rem;color:var(--muted)}.doc-card .dc-meta{font-size:.66rem;color:var(--dim);margin-top:6px}

/* ═══════ DEV STATUS TRACKER ═══════ */
.status-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:10px}
.status-card{background:var(--bg2);border:1px solid var(--line);border-radius:var(--radius-sm);padding:14px}
.status-card .sc-name{font-weight:700;font-size:.84rem;margin-bottom:6px}.status-card .sc-bar{height:6px;background:var(--line);border-radius:3px;margin:6px 0}.status-card .sc-fill{height:6px;border-radius:3px}
.status-card .sc-tags{display:flex;gap:4px;flex-wrap:wrap;margin-top:6px}

/* ═══════ STAKEHOLDER ACCEPTANCE ═══════ */
.note-form{background:var(--bg2);border:1px solid var(--line);border-radius:var(--radius-sm);padding:16px;margin-bottom:14px}
.note-form textarea{width:100%;background:var(--bg);border:1px solid var(--line);color:var(--text);border-radius:8px;padding:10px;font-size:.8rem;resize:vertical;min-height:80px;font-family:inherit;outline:none}
.note-form textarea:focus{border-color:var(--accent)}
.note-form select,.note-form input[type=text]{background:var(--bg);border:1px solid var(--line);color:var(--text);padding:6px 10px;border-radius:6px;font-size:.78rem;outline:none}
.note-form .btn-submit{background:linear-gradient(135deg,var(--accent),var(--accent2));color:#fff;border:none;padding:8px 18px;border-radius:8px;font-size:.8rem;font-weight:600;cursor:pointer;transition:.2s}.note-form .btn-submit:hover{transform:translateY(-1px);box-shadow:0 4px 12px rgba(249,115,22,.3)}
.note-history{max-height:350px;overflow-y:auto}
.note-item{border-bottom:1px solid rgba(30,41,59,.4);padding:10px 12px;font-size:.78rem}
.note-item .ni-hdr{display:flex;align-items:center;gap:8px;margin-bottom:4px}.note-item .ni-author{font-weight:700;color:var(--accent)}.note-item .ni-ts{color:var(--dim);font-size:.68rem;margin-left:auto}
.note-item .ni-target{color:var(--blue);font-size:.72rem}.note-item .ni-body{color:var(--muted);line-height:1.5}
.note-item .ni-flow{font-size:.7rem;color:var(--cyan);margin-top:4px}

/* ═══════ DEV AGENT TEAM ═══════ */
.dev-team-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(250px,1fr));gap:10px}
.dev-agent-card{background:var(--bg2);border:1px solid var(--line);border-radius:var(--radius-sm);padding:14px;transition:all .2s}.dev-agent-card:hover{border-color:var(--accent)}
.dev-agent-card .da-hdr{display:flex;align-items:center;gap:10px;margin-bottom:8px}.dev-agent-card .da-icon{width:40px;height:40px;border-radius:10px;display:flex;align-items:center;justify-content:center;font-size:1.1rem}
.dev-agent-card .da-name{font-weight:700;font-size:.84rem}.dev-agent-card .da-spec{font-size:.7rem;color:var(--muted)}
.dev-agent-card .da-skills{display:flex;flex-wrap:wrap;gap:3px;margin-top:6px}
.dev-agent-card .da-skill{font-size:.64rem;padding:2px 6px;border-radius:4px;background:rgba(255,255,255,.05);color:var(--muted)}
.dev-agent-card .da-load{margin-top:8px;font-size:.72rem;color:var(--dim)}
.ticket-board{max-height:380px;overflow-y:auto}
.ticket-row{display:flex;align-items:center;gap:8px;padding:6px 10px;border-bottom:1px solid rgba(30,41,59,.4);font-size:.76rem}
.ticket-row .tk-id{min-width:60px;font-weight:700;color:var(--blue);flex-shrink:0}.ticket-row .tk-title{flex:1}.ticket-row .tk-assignee{min-width:90px;color:var(--cyan);flex-shrink:0}.ticket-row .tk-pri{min-width:50px;flex-shrink:0}

/* ═══════ RESPONSIVE ═══════ */
@media(max-width:768px){
  .sidebar{width:48px}.sidebar .nav-item{width:36px;height:36px;font-size:.85rem}.sidebar .logo{width:32px;height:32px;font-size:.75rem}
  .main{margin-left:48px}.content{padding:14px}.top-bar{padding:10px 14px}
  .pipe-arrow{display:none}.pipeline{flex-direction:column}
  .kpi-grid{grid-template-columns:repeat(2,1fr)}
  .trace-svc{min-width:60px;font-size:.65rem}.metric-bar-label{min-width:80px}
  .lg-row{flex-wrap:wrap}.expert-grid{grid-template-columns:1fr}
  .doc-grid{grid-template-columns:1fr}.status-grid{grid-template-columns:1fr}.dev-team-grid{grid-template-columns:1fr}
}
</style>
</head>
<body>

<!-- ═══════ SIDEBAR ═══════ -->
<nav class="sidebar">
  <div class="logo">B</div>

  <!-- Stage 1: Setup & Foundation -->
  <div class="nav-divider"><span class="div-tip">1. Setup</span></div>
  <div class="nav-item active" data-section="overview"><i class="fas fa-home"></i><span class="tip">Overview</span></div>
  <div class="nav-item" data-section="requirements"><i class="fas fa-file-lines"></i><span class="tip">Requirements</span></div>
  <div class="nav-item" data-section="data"><i class="fas fa-database"></i><span class="tip">Data Model</span></div>
  <div class="nav-item" data-section="dashboards"><i class="fas fa-th-large"></i><span class="tip">Role Views</span></div>

  <!-- Stage 2: Design & Architecture -->
  <div class="nav-divider"><span class="div-tip">2. Design</span></div>
  <div class="nav-item" data-section="pipeline"><i class="fas fa-stream"></i><span class="tip">Pipeline</span></div>
  <div class="nav-item" data-section="agents"><i class="fas fa-robot"></i><span class="tip">Agent Mesh</span></div>
  <div class="nav-item" data-section="endpoints"><i class="fas fa-plug"></i><span class="tip">API Explorer</span></div>

  <!-- Stage 3: Development -->
  <div class="nav-divider"><span class="div-tip">3. Dev</span></div>
  <div class="nav-item" data-section="sprints"><i class="fas fa-tasks"></i><span class="tip">Sprints</span></div>
  <div class="nav-item" data-section="devstatus"><i class="fas fa-list-check"></i><span class="tip">Dev Status</span></div>
  <div class="nav-item" data-section="devteam"><i class="fas fa-people-group"></i><span class="tip">Dev Team</span></div>

  <!-- Stage 4: Testing & QA -->
  <div class="nav-divider"><span class="div-tip">4. QA</span></div>
  <div class="nav-item" data-section="testing"><i class="fas fa-vial"></i><span class="tip">Testing</span></div>
  <div class="nav-item" data-section="acceptance"><i class="fas fa-clipboard-check"></i><span class="tip">Acceptance</span></div>

  <!-- Stage 5: Deployment & Ops -->
  <div class="nav-divider"><span class="div-tip">5. Ops</span></div>
  <div class="nav-item" data-section="deployment"><i class="fas fa-rocket"></i><span class="tip">Deployment</span></div>
  <div class="nav-item" data-section="observability"><i class="fas fa-wave-square"></i><span class="tip">Observability</span></div>
  <div class="nav-item" data-section="internals"><i class="fas fa-microscope"></i><span class="tip">Internals</span></div>

  <!-- Stage 6: Review & Governance -->
  <div class="nav-divider"><span class="div-tip">6. Review</span></div>
  <div class="nav-item" data-section="experts"><i class="fas fa-users-gear"></i><span class="tip">Expert Review</span></div>
  <div class="nav-item" data-section="links"><i class="fas fa-external-link-alt"></i><span class="tip">Quick Links</span></div>

  <div class="spacer"></div>
  <div class="nav-item" id="btn-refresh" title="Refresh"><i class="fas fa-sync-alt"></i><span class="tip">Refresh Data</span></div>
</nav>

<!-- ═══════ MAIN ═══════ -->
<div class="main">

  <!-- Top Bar -->
  <div class="top-bar">
    <h1><i class="fas fa-atom me-2" style="-webkit-text-fill-color:var(--accent)"></i>BANF Unified Ecosystem</h1>
    <div class="meta">
      <span><span class="status-dot loading" id="health-dot"></span> <span id="health-text">Checking…</span></span>
      <span id="version-badge">—</span>
      <span id="last-refresh">—</span>
    </div>
  </div>

  <div class="content">

    <!-- ══════════════════════════════════════ -->
    <!-- SECTION: OVERVIEW                      -->
    <!-- ══════════════════════════════════════ -->
    <div class="section active" id="sec-overview">

      <div class="kpi-grid" id="kpi-row"></div>

      <!-- Mini Pipeline -->
      <div class="card-d">
        <h2><i class="fas fa-stream"></i> Agentic Lifecycle Pipeline</h2>
        <div class="pipeline">
          <div class="pipe-step ps-req"><div class="pipe-icon"><i class="fas fa-clipboard-list"></i></div><h6>Requirements</h6><small>req-agent</small></div>
          <div class="pipe-arrow"><i class="fas fa-chevron-right"></i></div>
          <div class="pipe-step ps-des"><div class="pipe-icon"><i class="fas fa-drafting-compass"></i></div><h6>Design</h6><small>des-agent</small></div>
          <div class="pipe-arrow"><i class="fas fa-chevron-right"></i></div>
          <div class="pipe-step ps-dev"><div class="pipe-icon"><i class="fas fa-code"></i></div><h6>Development</h6><small>dev-agent</small></div>
          <div class="pipe-arrow"><i class="fas fa-chevron-right"></i></div>
          <div class="pipe-step ps-tst"><div class="pipe-icon"><i class="fas fa-vial"></i></div><h6>Testing</h6><small>tst-agent</small></div>
          <div class="pipe-arrow"><i class="fas fa-chevron-right"></i></div>
          <div class="pipe-step ps-dpl"><div class="pipe-icon"><i class="fas fa-rocket"></i></div><h6>Deployment</h6><small>dpl-agent</small></div>
          <div class="pipe-arrow"><i class="fas fa-chevron-right"></i></div>
          <div class="pipe-step ps-ops"><div class="pipe-icon"><i class="fas fa-heartbeat"></i></div><h6>Operations</h6><small>ops-agent</small></div>
          <div class="pipe-arrow"><i class="fas fa-chevron-right"></i></div>
          <div class="pipe-step ps-mlo"><div class="pipe-icon"><i class="fas fa-brain"></i></div><h6>MLOps</h6><small>mlo-agent</small></div>
        </div>
      </div>

      <!-- Architecture Overview -->
      <div class="row g-3">
        <div class="col-lg-6">
          <div class="card-d" style="height:100%">
            <h2><i class="fas fa-layer-group"></i> System Modules</h2>
            <table class="t">
              <thead><tr><th>Module</th><th>Version</th><th>Endpoints</th><th>Status</th></tr></thead>
              <tbody>
                <tr><td>Admin API</td><td>v5.10.0</td><td>41</td><td><span class="badge-s badge-green">Active</span></td></tr>
                <tr><td>CRM API</td><td>v5.5.0</td><td>26</td><td><span class="badge-s badge-green">Active</span></td></tr>
                <tr><td>Member API</td><td>v5.4.0</td><td>11</td><td><span class="badge-s badge-green">Active</span></td></tr>
                <tr><td>RAG / Knowledge Engine</td><td>v5.6.0</td><td>11</td><td><span class="badge-s badge-green">Active</span></td></tr>
                <tr><td>Evite System</td><td>v5.8.0</td><td>11</td><td><span class="badge-s badge-green">Active</span></td></tr>
                <tr><td>Survey Engine</td><td>v5.8.0</td><td>15</td><td><span class="badge-s badge-green">Active</span></td></tr>
                <tr><td>Membership Drive</td><td>v4.0</td><td>18</td><td><span class="badge-s badge-green">Active</span></td></tr>
                <tr><td>Google Drive Sync</td><td>v5.7.0</td><td>7</td><td><span class="badge-s badge-green">Active</span></td></tr>
                <tr><td>Data Mapper / Import</td><td>v5.7.0</td><td>5</td><td><span class="badge-s badge-green">Active</span></td></tr>
                <tr><td>Archive Mapper</td><td>v5.8.0</td><td>11</td><td><span class="badge-s badge-green">Active</span></td></tr>
                <tr><td>Comms Correction</td><td>v5.8.0</td><td>11</td><td><span class="badge-s badge-green">Active</span></td></tr>
                <tr><td>EC Onboarding Gate</td><td>v5.10.0</td><td>7</td><td><span class="badge-s badge-green">Active</span></td></tr>
                <tr><td>Zelle Payments</td><td>v5.4.0</td><td>10</td><td><span class="badge-s badge-green">Active</span></td></tr>
                <tr><td>Landing Page CRM</td><td>v5.9.0</td><td>3</td><td><span class="badge-s badge-green">Active</span></td></tr>
                <tr><td>Agent Orchestrator</td><td>v5.4.0</td><td>—</td><td><span class="badge-s badge-blue">Backend</span></td></tr>
                <tr><td>Computer Agent / Tests</td><td>v5.4.0</td><td>5</td><td><span class="badge-s badge-green">Active</span></td></tr>
              </tbody>
            </table>
          </div>
        </div>
        <div class="col-lg-6">
          <div class="card-d" style="height:100%">
            <h2><i class="fas fa-server"></i> Platform Stack</h2>
            <table class="t">
              <thead><tr><th>Layer</th><th>Technology</th><th>Details</th></tr></thead>
              <tbody>
                <tr><td>Runtime</td><td>Wix Velo</td><td>Cloud functions, SSR, wixData</td></tr>
                <tr><td>Backend</td><td>Node.js (Velo)</td><td>36+ .js modules, 6705 LOC router</td></tr>
                <tr><td>Database</td><td>Wix CMS</td><td>40+ collections (wixData CRUD)</td></tr>
                <tr><td>LLM</td><td>HuggingFace</td><td>Llama 3.1 8B + Mistral 7B fallback</td></tr>
                <tr><td>RAG</td><td>Custom TF-IDF</td><td>25 knowledge chunks, 40+ docs</td></tr>
                <tr><td>Auth</td><td>Custom RBAC</td><td>5 roles, 40+ permissions</td></tr>
                <tr><td>Dashboards</td><td>GitHub Pages</td><td>Static HTML, JS fetch to API</td></tr>
                <tr><td>Email</td><td>Gmail API</td><td>OAuth2, auto-responses</td></tr>
                <tr><td>DevOps</td><td>Wix CLI</td><td>npx @wix/cli publish</td></tr>
                <tr><td>Testing</td><td>Playwright + Custom</td><td>Browser agent + HTTP suite</td></tr>
                <tr><td>Hosting</td><td>Wix + GitHub</td><td>banfwix.wixsite.com/banf1</td></tr>
                <tr><td>Version Control</td><td>Git / GitHub</td><td>banf1 + banf1-wix repos</td></tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- Test Summary -->
      <div class="card-d mt-3">
        <h2><i class="fas fa-vial"></i> Latest Test Results</h2>
        <div class="row g-3">
          <div class="col-md-4">
            <div style="background:var(--bg2);border:1px solid var(--line);border-radius:var(--radius-sm);padding:14px">
              <h3 style="font-size:.82rem;color:var(--green);margin:0 0 8px"><i class="fas fa-check-circle me-1"></i>Comprehensive Suite</h3>
              <div style="font-size:2rem;font-weight:800;color:#fff">100%</div>
              <div style="font-size:.74rem;color:var(--muted)">158 tests &bull; 126 passed &bull; 32 skipped &bull; 0 failed</div>
              <div style="height:4px;background:var(--line);border-radius:2px;margin-top:8px"><div style="height:4px;background:var(--green);border-radius:2px;width:100%"></div></div>
            </div>
          </div>
          <div class="col-md-4">
            <div style="background:var(--bg2);border:1px solid var(--line);border-radius:var(--radius-sm);padding:14px">
              <h3 style="font-size:.82rem;color:var(--yellow);margin:0 0 8px"><i class="fas fa-globe me-1"></i>Browser Agent</h3>
              <div style="font-size:2rem;font-weight:800;color:#fff">57%</div>
              <div style="font-size:.74rem;color:var(--muted)">42 tests &bull; 24 passed &bull; 18 warnings &bull; 0 failed</div>
              <div style="height:4px;background:var(--line);border-radius:2px;margin-top:8px"><div style="height:4px;background:var(--yellow);border-radius:2px;width:57%"></div></div>
            </div>
          </div>
          <div class="col-md-4">
            <div style="background:var(--bg2);border:1px solid var(--line);border-radius:var(--radius-sm);padding:14px">
              <h3 style="font-size:.82rem;color:var(--blue);margin:0 0 8px"><i class="fas fa-network-wired me-1"></i>HTTP Test Suite</h3>
              <div style="font-size:2rem;font-weight:800;color:#fff">81%</div>
              <div style="font-size:.74rem;color:var(--muted)">70 tests &bull; 57 passed &bull; 13 failed</div>
              <div style="height:4px;background:var(--line);border-radius:2px;margin-top:8px"><div style="height:4px;background:var(--blue);border-radius:2px;width:81%"></div></div>
            </div>
          </div>
        </div>
      </div>

    </div>

    <!-- ══════════════════════════════════════ -->
    <!-- SECTION: PIPELINE                      -->
    <!-- ══════════════════════════════════════ -->
    <div class="section" id="sec-pipeline">
      <div class="card-d">
        <h2><i class="fas fa-stream"></i> Full Agentic Lifecycle Pipeline</h2>
        <p style="font-size:.84rem;color:var(--muted);margin-bottom:14px">Each stage is owned by a specialist agent. Human gates control transitions. The Orchestrator meta-agent monitors the full pipeline.</p>
        <div class="pipeline">
          <div class="pipe-step ps-req"><div class="pipe-icon"><i class="fas fa-clipboard-list"></i></div><h6>Requirements</h6><small>req-agent</small></div>
          <div class="pipe-arrow"><i class="fas fa-chevron-right"></i></div>
          <div class="pipe-step ps-des"><div class="pipe-icon"><i class="fas fa-drafting-compass"></i></div><h6>Design</h6><small>des-agent</small></div>
          <div class="pipe-arrow"><i class="fas fa-chevron-right"></i></div>
          <div class="pipe-step ps-dev"><div class="pipe-icon"><i class="fas fa-code"></i></div><h6>Development</h6><small>dev-agent</small></div>
          <div class="pipe-arrow"><i class="fas fa-chevron-right"></i></div>
          <div class="pipe-step ps-tst"><div class="pipe-icon"><i class="fas fa-vial"></i></div><h6>Testing</h6><small>tst-agent</small></div>
          <div class="pipe-arrow"><i class="fas fa-chevron-right"></i></div>
          <div class="pipe-step ps-dpl"><div class="pipe-icon"><i class="fas fa-rocket"></i></div><h6>Deployment</h6><small>dpl-agent</small></div>
          <div class="pipe-arrow"><i class="fas fa-chevron-right"></i></div>
          <div class="pipe-step ps-ops"><div class="pipe-icon"><i class="fas fa-heartbeat"></i></div><h6>Operations</h6><small>ops-agent</small></div>
          <div class="pipe-arrow"><i class="fas fa-chevron-right"></i></div>
          <div class="pipe-step ps-mlo"><div class="pipe-icon"><i class="fas fa-brain"></i></div><h6>MLOps</h6><small>mlo-agent</small></div>
        </div>
      </div>

      <!-- Detailed Phases -->
      <div class="card-d">
        <h2><i class="fas fa-layer-group"></i> Pipeline Stage Detail</h2>
        <table class="t">
          <thead><tr><th>Stage</th><th>Agent</th><th>Inputs</th><th>Outputs</th><th>Human Gate</th><th>Automation Triggers</th></tr></thead>
          <tbody>
            <tr><td><span class="badge-s badge-blue">Requirements</span></td><td>req-agent</td><td>User feedback, raw requests</td><td>Classified requirements, stories, AC</td><td>PO approves priority</td><td>feedback_submitted → classify</td></tr>
            <tr><td><span class="badge-s badge-purple">Design</span></td><td>des-agent</td><td>Approved stories</td><td>API contracts, schema diffs, ADRs</td><td>Architect review</td><td>story_linked → gen contracts</td></tr>
            <tr><td><span class="badge-s badge-green">Development</span></td><td>dev-agent</td><td>Approved designs</td><td>Scaffolded code, PR reviews</td><td>PR reviewer</td><td>design_approved → scaffold</td></tr>
            <tr><td><span class="badge-s badge-yellow">Testing</span></td><td>tst-agent</td><td>Merged code</td><td>Test plans, results, coverage</td><td>QA sign-off</td><td>code_merged → gen test plan</td></tr>
            <tr><td><span class="badge-s badge-orange">Deployment</span></td><td>dpl-agent</td><td>Gate-ready code</td><td>Published version, changelog</td><td>DevOps approval</td><td>gate_ready → pre-checks</td></tr>
            <tr><td><span class="badge-s badge-red">Operations</span></td><td>ops-agent</td><td>Live system</td><td>Health reports, incidents</td><td>SRE escalation ≥ P1</td><td>cron_5min → health check</td></tr>
            <tr><td><span class="badge-s badge-cyan">MLOps</span></td><td>mlo-agent</td><td>Agent metrics</td><td>Eval reports, prompt versions</td><td>ML engineer review</td><td>cron_daily → evaluate</td></tr>
          </tbody>
        </table>
      </div>

      <!-- Event Flow -->
      <div class="card-d">
        <h2><i class="fas fa-exchange-alt"></i> Event Flow & Visibility Matrix</h2>
        <table class="t">
          <thead><tr><th>Event</th><th>Source</th><th>Stakeholder</th><th>Developer</th><th>Tester</th><th>DevOps</th><th>MLOps</th></tr></thead>
          <tbody>
            <tr><td>requirement_created</td><td>req-agent</td><td>&#10003;</td><td>&#10003;</td><td></td><td></td><td></td></tr>
            <tr><td>design_approved</td><td>des-agent</td><td></td><td>&#10003;</td><td>&#10003;</td><td></td><td></td></tr>
            <tr><td>code_merged</td><td>dev-agent</td><td></td><td>&#10003;</td><td>&#10003;</td><td>&#10003;</td><td></td></tr>
            <tr><td>test_passed</td><td>tst-agent</td><td>&#10003;</td><td>&#10003;</td><td>&#10003;</td><td>&#10003;</td><td></td></tr>
            <tr><td>deploy_success</td><td>dpl-agent</td><td>&#10003;</td><td>&#10003;</td><td>&#10003;</td><td>&#10003;</td><td>&#10003;</td></tr>
            <tr><td>incident_created</td><td>ops-agent</td><td>&#10003;</td><td></td><td></td><td>&#10003;</td><td></td></tr>
            <tr><td>guardrail_triggered</td><td>mlo-agent</td><td></td><td></td><td></td><td>&#10003;</td><td>&#10003;</td></tr>
            <tr><td>drift_detected</td><td>mlo-agent</td><td></td><td></td><td></td><td></td><td>&#10003;</td></tr>
          </tbody>
        </table>
      </div>
    </div>

    <!-- ══════════════════════════════════════ -->
    <!-- SECTION: AGENTS                        -->
    <!-- ══════════════════════════════════════ -->
    <div class="section" id="sec-agents">
      <div class="card-d">
        <h2><i class="fas fa-project-diagram"></i> Agent Mesh Architecture</h2>
        <pre style="background:#080d16;border:1px solid var(--line);border-radius:10px;padding:18px;font-family:Consolas,Monaco,monospace;font-size:.75rem;color:#8aa0b8;overflow-x:auto;line-height:1.3">
┌──────────────────────────────────────────────────────────────────────────────┐
│                         AGENT MESH  (Wix Velo)                                │
│                                                                               │
│   LIFECYCLE AGENTS                         DOMAIN AGENTS (existing)          │
│   ┌────────────┐  ┌────────────┐          ┌────────────┐  ┌────────────┐    │
│   │ req-agent  │  │ des-agent  │          │  events    │  │ membership │    │
│   └─────┬──────┘  └─────┬──────┘          └────────────┘  └────────────┘    │
│         │               │                 ┌────────────┐  ┌────────────┐    │
│   ┌─────▼───────────────▼──────┐          │  payment   │  │ complaint  │    │
│   │  EVENT BUS (AgentEventLog) │          └────────────┘  └────────────┘    │
│   └─────┬───────────────┬──────┘          ┌────────────┐  ┌────────────┐    │
│         │               │                 │ sponsorship│  │   career   │    │
│   ┌─────▼──────┐  ┌─────▼──────┐          └────────────┘  └────────────┘    │
│   │ dev-agent  │  │ tst-agent  │          ┌────────────┐                    │
│   └─────┬──────┘  └─────┬──────┘          │  general   │                    │
│         │               │                 └────────────┘                    │
│   ┌─────▼──────┐  ┌─────▼──────┐                                           │
│   │ dpl-agent  │  │ ops-agent  │     ┌─────────────────────────────────┐    │
│   └─────┬──────┘  └─────┬──────┘     │     ORCHESTRATOR (meta-agent)  │    │
│         │               │            │  route · detect · escalate     │    │
│   ┌─────▼──────┐        │            │  arbitrate · digest            │    │
│   │ mlo-agent  │────────┘            └─────────────────────────────────┘    │
│   └────────────┘                                                            │
└──────────────────────────────────────────────────────────────────────────────┘</pre>
      </div>

      <!-- Lifecycle Agents  -->
      <div class="card-d">
        <h2><i class="fas fa-cogs"></i> Lifecycle Agents (DevOps / MLOps)</h2>
        <div class="agent-grid" id="lifecycle-agents"></div>
      </div>

      <!-- Domain Agents -->
      <div class="card-d">
        <h2><i class="fas fa-users-cog"></i> Domain Agents (CRM / Operations)</h2>
        <div class="agent-grid" id="domain-agents"></div>
      </div>
    </div>

    <!-- ══════════════════════════════════════ -->
    <!-- SECTION: ENDPOINTS                     -->
    <!-- ══════════════════════════════════════ -->
    <div class="section" id="sec-endpoints">
      <div class="card-d">
        <h2><i class="fas fa-plug"></i> API Endpoint Explorer <span style="font-weight:400;font-size:.74rem;color:var(--muted);margin-left:8px">(196 endpoints)</span></h2>
        <p style="font-size:.8rem;color:var(--muted);margin-bottom:14px">Base URL: <code style="color:var(--accent)">https://banfwix.wixsite.com/banf1/_functions/</code></p>
        <div style="margin-bottom:12px"><input type="text" id="ep-search" placeholder="Filter endpoints…" style="background:var(--bg2);border:1px solid var(--line);color:var(--text);padding:8px 14px;border-radius:8px;width:100%;max-width:400px;font-size:.82rem;outline:none"></div>
        <div id="ep-list"></div>
      </div>
    </div>

    <!-- ══════════════════════════════════════ -->
    <!-- SECTION: TESTING                       -->
    <!-- ══════════════════════════════════════ -->
    <div class="section" id="sec-testing">
      <div class="card-d">
        <h2><i class="fas fa-vial"></i> Test Suites & Quality Gates</h2>
        <div class="kpi-grid">
          <div class="kpi green"><div class="v">270</div><div class="k">Total Tests</div></div>
          <div class="kpi green"><div class="v">207</div><div class="k">Passed</div></div>
          <div class="kpi red"><div class="v">13</div><div class="k">Failed</div></div>
          <div class="kpi yellow"><div class="v">50</div><div class="k">Warnings/Skip</div></div>
          <div class="kpi blue"><div class="v">3</div><div class="k">Test Suites</div></div>
          <div class="kpi cyan"><div class="v">83%</div><div class="k">Overall Pass Rate</div></div>
        </div>
      </div>

      <div class="card-d">
        <h2><i class="fas fa-list-check"></i> Suite Breakdown</h2>
        <table class="t">
          <thead><tr><th>Suite</th><th>Version</th><th>Date</th><th>Total</th><th>Pass</th><th>Fail</th><th>Warn/Skip</th><th>Rate</th><th>Engine</th></tr></thead>
          <tbody>
            <tr>
              <td><strong>Comprehensive Suite</strong></td><td>v3.0</td><td>2026-02-23</td><td>158</td>
              <td><span class="badge-s badge-green">126</span></td><td><span class="badge-s badge-green">0</span></td><td>32</td>
              <td><span class="badge-s badge-green">100%</span></td><td>Node.js HTTP</td>
            </tr>
            <tr>
              <td><strong>HTTP Test Suite</strong></td><td>v5.8.0</td><td>2026-02-22</td><td>70</td>
              <td><span class="badge-s badge-green">57</span></td><td><span class="badge-s badge-red">13</span></td><td>0</td>
              <td><span class="badge-s badge-yellow">81%</span></td><td>Node.js HTTP</td>
            </tr>
            <tr>
              <td><strong>Browser Agent</strong></td><td>v5.8.0</td><td>2026-02-22</td><td>42</td>
              <td><span class="badge-s badge-green">24</span></td><td><span class="badge-s badge-green">0</span></td><td>18</td>
              <td><span class="badge-s badge-yellow">57%</span></td><td>Playwright + LLM</td>
            </tr>
          </tbody>
        </table>
      </div>

      <div class="card-d">
        <h2><i class="fas fa-door-open"></i> Release Quality Gate</h2>
        <table class="t">
          <thead><tr><th>Gate Criterion</th><th>Threshold</th><th>Current</th><th>Status</th></tr></thead>
          <tbody>
            <tr><td>Comprehensive pass rate</td><td>≥ 95%</td><td>100%</td><td><span class="badge-s badge-green">PASS</span></td></tr>
            <tr><td>No P0 failures</td><td>0</td><td>0</td><td><span class="badge-s badge-green">PASS</span></td></tr>
            <tr><td>HTTP endpoint coverage</td><td>≥ 80%</td><td>81%</td><td><span class="badge-s badge-green">PASS</span></td></tr>
            <tr><td>Browser agent pass rate</td><td>≥ 70%</td><td>57%</td><td><span class="badge-s badge-red">FAIL</span></td></tr>
            <tr><td>Health endpoint responds</td><td>HTTP 200</td><td id="gate-health">—</td><td id="gate-health-badge">—</td></tr>
          </tbody>
        </table>
      </div>
    </div>

    <!-- ══════════════════════════════════════ -->
    <!-- SECTION: DEPLOYMENT                    -->
    <!-- ══════════════════════════════════════ -->
    <div class="section" id="sec-deployment">
      <div class="card-d">
        <h2><i class="fas fa-rocket"></i> Deployment Pipeline (wix-agent 6-Phase)</h2>
        <div class="pipeline">
          <div class="pipe-step" style="background:rgba(99,102,241,.1);border:1px solid rgba(99,102,241,.3)"><div class="pipe-icon" style="color:var(--indigo)"><i class="fas fa-cog"></i></div><h6>1. Setup</h6><small>Git, Node, config</small></div>
          <div class="pipe-arrow"><i class="fas fa-chevron-right"></i></div>
          <div class="pipe-step" style="background:rgba(34,197,94,.1);border:1px solid rgba(34,197,94,.3)"><div class="pipe-icon" style="color:var(--green)"><i class="fas fa-code"></i></div><h6>2. Dev</h6><small>Dev server, validate</small></div>
          <div class="pipe-arrow"><i class="fas fa-chevron-right"></i></div>
          <div class="pipe-step" style="background:rgba(168,85,247,.1);border:1px solid rgba(168,85,247,.3)"><div class="pipe-icon" style="color:var(--purple)"><i class="fas fa-database"></i></div><h6>3. Collections</h6><small>Wix CMS setup</small></div>
          <div class="pipe-arrow"><i class="fas fa-chevron-right"></i></div>
          <div class="pipe-step" style="background:rgba(234,179,8,.1);border:1px solid rgba(234,179,8,.3)"><div class="pipe-icon" style="color:var(--yellow)"><i class="fas fa-vial"></i></div><h6>4. Test</h6><small>Validate + count</small></div>
          <div class="pipe-arrow"><i class="fas fa-chevron-right"></i></div>
          <div class="pipe-step" style="background:rgba(249,115,22,.1);border:1px solid rgba(249,115,22,.3)"><div class="pipe-icon" style="color:var(--accent)"><i class="fas fa-upload"></i></div><h6>5. Publish</h6><small>wix cli publish</small></div>
          <div class="pipe-arrow"><i class="fas fa-chevron-right"></i></div>
          <div class="pipe-step" style="background:rgba(239,68,68,.1);border:1px solid rgba(239,68,68,.3)"><div class="pipe-icon" style="color:var(--red)"><i class="fas fa-heartbeat"></i></div><h6>6. Monitor</h6><small>Health, tag</small></div>
        </div>
      </div>

      <div class="row g-3">
        <div class="col-lg-6">
          <div class="card-d" style="height:100%">
            <h2><i class="fas fa-history"></i> Version History</h2>
            <table class="t">
              <thead><tr><th>Version</th><th>Date</th><th>Changes</th></tr></thead>
              <tbody>
                <tr><td><span class="badge-s badge-orange">5.10.1-ec-reminder</span></td><td>Feb 2026</td><td>EC reminder email feature</td></tr>
                <tr><td><span class="badge-s badge-blue">5.10.0</span></td><td>Feb 2026</td><td>EC onboarding gate chain</td></tr>
                <tr><td><span class="badge-s badge-dim">5.9.0</span></td><td>Feb 2026</td><td>Membership drive v2.0, landing CRM</td></tr>
                <tr><td><span class="badge-s badge-dim">5.8.0</span></td><td>Jan 2026</td><td>Family fix agent, CRM audit, evite, survey</td></tr>
                <tr><td><span class="badge-s badge-dim">5.7.0</span></td><td>Jan 2026</td><td>Google Drive sync, bulk data mapper</td></tr>
                <tr><td><span class="badge-s badge-dim">5.6.0</span></td><td>Jan 2026</td><td>RAG knowledge engine, sensitivity map</td></tr>
                <tr><td><span class="badge-s badge-dim">5.5.0</span></td><td>Dec 2025</td><td>Full CRM — family ID, profiles, org roles</td></tr>
                <tr><td><span class="badge-s badge-dim">5.4.0</span></td><td>Dec 2025</td><td>Agents, RAG, email, RBAC, dashboards</td></tr>
              </tbody>
            </table>
          </div>
        </div>
        <div class="col-lg-6">
          <div class="card-d" style="height:100%">
            <h2><i class="fas fa-terminal"></i> Deploy Config</h2>
            <pre style="background:var(--bg2);border:1px solid var(--line);border-radius:8px;padding:14px;font-size:.78rem;color:var(--muted);overflow-x:auto;margin:0">
{
  "projectPath": "c:\\projects\\banf\\banf1-wix",
  "siteId":      "c13ae8c5-7053-4f2d-9a9a-371869be4395",
  "account":     "banfjax@gmail.com",
  "liveUrl":     "https://banfwix.wixsite.com/banf1",
  "collections": [
    "Sponsors","Events","Members","Magazine",
    "RadioSchedule","Announcements","Volunteers"
  ],
  "maxRetries": 3,
  "timeout":    120000
}
</pre>
            <h3 style="margin-top:14px">Publish Command</h3>
            <pre style="background:var(--bg2);border:1px solid var(--line);border-radius:8px;padding:10px 14px;font-size:.78rem;color:var(--green);margin:0">cd banf1-wix && npx @wix/cli publish --yes</pre>
            <h3>Rollback</h3>
            <pre style="background:var(--bg2);border:1px solid var(--line);border-radius:8px;padding:10px 14px;font-size:.78rem;color:var(--red);margin:0">git checkout &lt;commit&gt; -- src/backend/ && npx @wix/cli publish -y</pre>
          </div>
        </div>
      </div>
    </div>

    <!-- ══════════════════════════════════════ -->
    <!-- SECTION: DATA MODEL                    -->
    <!-- ══════════════════════════════════════ -->
    <div class="section" id="sec-data">
      <div class="card-d">
        <h2><i class="fas fa-database"></i> Wix CMS Collections</h2>
        <div class="row g-3">
          <div class="col-lg-6">
            <h3>Existing Collections (40+)</h3>
            <div id="existing-collections"></div>
          </div>
          <div class="col-lg-6">
            <h3>New Platform Collections (6)</h3>
            <div id="new-collections"></div>
          </div>
        </div>
      </div>
    </div>

    <!-- ══════════════════════════════════════ -->
    <!-- SECTION: SPRINTS                       -->
    <!-- ══════════════════════════════════════ -->
    <div class="section" id="sec-sprints">
      <div class="card-d">
        <h2><i class="fas fa-tasks"></i> Sprint Execution Roadmap (12 Weeks)</h2>
        <div class="sprint-track" id="sprint-board"></div>
      </div>
      <div class="card-d">
        <h2><i class="fas fa-flag-checkered"></i> Epic Tracker</h2>
        <table class="t">
          <thead><tr><th>Epic</th><th>Title</th><th>Sprint</th><th>Stories</th><th>Points</th><th>Status</th></tr></thead>
          <tbody>
            <tr><td><span class="badge-s badge-blue">EP-01</span></td><td>RBAC & Secrets Hardening</td><td>1–2</td><td>2</td><td>13</td><td><span class="badge-s badge-yellow">Planned</span></td></tr>
            <tr><td><span class="badge-s badge-blue">EP-02</span></td><td>Data Governance Framework</td><td>1–2</td><td>2</td><td>13</td><td><span class="badge-s badge-yellow">Planned</span></td></tr>
            <tr><td><span class="badge-s badge-blue">EP-03</span></td><td>Event-Driven Architecture</td><td>2–3</td><td>2</td><td>13</td><td><span class="badge-s badge-dim">Backlog</span></td></tr>
            <tr><td><span class="badge-s badge-blue">EP-04</span></td><td>Agent Intelligence Upgrade</td><td>2–3</td><td>2</td><td>10</td><td><span class="badge-s badge-dim">Backlog</span></td></tr>
            <tr><td><span class="badge-s badge-blue">EP-05</span></td><td>Wix Platform Modernization</td><td>3–4</td><td>2</td><td>10</td><td><span class="badge-s badge-dim">Backlog</span></td></tr>
            <tr><td><span class="badge-s badge-blue">EP-06</span></td><td>Testing & Observability</td><td>3–4</td><td>2</td><td>10</td><td><span class="badge-s badge-dim">Backlog</span></td></tr>
            <tr><td><span class="badge-s badge-blue">EP-07</span></td><td>Performance & Cost Optimization</td><td>4–5</td><td>2</td><td>8</td><td><span class="badge-s badge-dim">Backlog</span></td></tr>
            <tr><td><span class="badge-s badge-blue">EP-08</span></td><td>UX Polish & Accessibility</td><td>4–5</td><td>1</td><td>5</td><td><span class="badge-s badge-dim">Backlog</span></td></tr>
            <tr><td><span class="badge-s badge-blue">EP-09</span></td><td>Business Feature Completion</td><td>5–6</td><td>2</td><td>8</td><td><span class="badge-s badge-dim">Backlog</span></td></tr>
            <tr><td><span class="badge-s badge-blue">EP-10</span></td><td>Documentation & Runbooks</td><td>6</td><td>1</td><td>3</td><td><span class="badge-s badge-dim">Backlog</span></td></tr>
          </tbody>
        </table>
      </div>
    </div>

    <!-- ══════════════════════════════════════ -->
    <!-- SECTION: ROLE DASHBOARDS               -->
    <!-- ══════════════════════════════════════ -->
    <div class="section" id="sec-dashboards">
      <div class="card-d">
        <h2><i class="fas fa-th-large"></i> Role-Synchronized Dashboard Views</h2>
        <p style="font-size:.82rem;color:var(--muted);margin-bottom:14px">Each role sees only the widgets and events relevant to their function. Dashboards sync via the AgentEventLog event bus.</p>
        <div class="role-tabs" id="role-tabs"></div>
        <div id="role-panels"></div>
      </div>
    </div>

    <!-- ══════════════════════════════════════ -->
    <!-- SECTION: QUICK LINKS                   -->
    <!-- ══════════════════════════════════════ -->
    <div class="section" id="sec-links">
      <div class="card-d">
        <h2><i class="fas fa-external-link-alt"></i> Ecosystem Quick Links</h2>
        <div class="link-grid" id="link-grid"></div>
      </div>
    </div>

    <!-- ══════════════════════════════════════ -->
    <!-- SECTION: OBSERVABILITY (OpenTelemetry) -->
    <!-- ══════════════════════════════════════ -->
    <div class="section" id="sec-observability">
      <div class="kpi-grid" id="otel-kpi-row"></div>

      <div class="card-d">
        <h2><i class="fas fa-wave-square" style="color:var(--cyan)"></i> OpenTelemetry Observability Layer</h2>
        <p style="font-size:.82rem;color:var(--muted);margin-bottom:12px">Platform-wide logs, traces, and metrics — correlated by trace ID. Alerts fire proactively before users notice.</p>
        <div class="otel-tabs" id="otel-tabs">
          <div class="otel-tab active" data-otel="logs"><i class="fas fa-file-alt me-1"></i>Logs</div>
          <div class="otel-tab" data-otel="traces"><i class="fas fa-project-diagram me-1"></i>Traces</div>
          <div class="otel-tab" data-otel="metrics"><i class="fas fa-chart-bar me-1"></i>Metrics</div>
          <div class="otel-tab" data-otel="alerts"><i class="fas fa-bell me-1"></i>Alerts</div>
          <div class="otel-tab" data-otel="proactive"><i class="fas fa-magic me-1"></i>Proactive</div>
        </div>

        <!-- Logs Panel -->
        <div class="otel-panel active" id="otel-logs">
          <div style="display:flex;gap:8px;margin-bottom:10px;flex-wrap:wrap">
            <select id="log-level-filter" style="background:var(--bg2);border:1px solid var(--line);color:var(--text);padding:4px 8px;border-radius:6px;font-size:.74rem">
              <option value="all">All Levels</option><option value="error">Error</option><option value="warn">Warn</option><option value="info">Info</option><option value="debug">Debug</option>
            </select>
            <select id="log-svc-filter" style="background:var(--bg2);border:1px solid var(--line);color:var(--text);padding:4px 8px;border-radius:6px;font-size:.74rem">
              <option value="all">All Services</option><option value="http-router">http-router</option><option value="agent-orch">agent-orch</option><option value="wixData">wixData</option><option value="email-svc">email-svc</option><option value="rag-engine">rag-engine</option><option value="auth-rbac">auth-rbac</option><option value="evite-svc">evite-svc</option>
            </select>
            <input type="text" id="log-search" placeholder="Search logs…" style="background:var(--bg2);border:1px solid var(--line);color:var(--text);padding:4px 10px;border-radius:6px;flex:1;font-size:.74rem;min-width:150px;outline:none">
          </div>
          <div style="background:var(--bg);border:1px solid var(--line);border-radius:8px;max-height:380px;overflow-y:auto;padding:4px" id="log-container"></div>
        </div>

        <!-- Traces Panel -->
        <div class="otel-panel" id="otel-traces">
          <p style="font-size:.78rem;color:var(--muted);margin-bottom:10px">Distributed trace waterfall — shows how a request flows through BANF service layers.</p>
          <div id="trace-container"></div>
        </div>

        <!-- Metrics Panel -->
        <div class="otel-panel" id="otel-metrics">
          <div class="row g-3">
            <div class="col-lg-6">
              <div class="card-d" style="margin-bottom:0">
                <h3 style="font-size:.84rem;color:var(--cyan)"><i class="fas fa-tachometer-alt me-1"></i>p95 Latency by Module (ms)</h3>
                <div id="latency-bars"></div>
              </div>
            </div>
            <div class="col-lg-6">
              <div class="card-d" style="margin-bottom:0">
                <h3 style="font-size:.84rem;color:var(--red)"><i class="fas fa-exclamation-triangle me-1"></i>Error Rate by Module (%)</h3>
                <div id="error-bars"></div>
              </div>
            </div>
          </div>
          <div class="card-d mt-3">
            <h3 style="font-size:.84rem;color:var(--green)"><i class="fas fa-exchange-alt me-1"></i>Throughput — Requests / 5 min</h3>
            <div id="throughput-bars"></div>
          </div>
        </div>

        <!-- Alerts Panel -->
        <div class="otel-panel" id="otel-alerts">
          <p style="font-size:.78rem;color:var(--muted);margin-bottom:10px">Configurable alert rules with severity-based routing. Alerts integrate with ops-agent for automated incident response.</p>
          <div id="alert-rules"></div>
        </div>

        <!-- Proactive Panel -->
        <div class="otel-panel" id="otel-proactive">
          <p style="font-size:.78rem;color:var(--muted);margin-bottom:10px">AI-powered proactive analysis — ops-agent and mlo-agent detect patterns BEFORE failures occur.</p>
          <div id="proactive-items"></div>
        </div>
      </div>
    </div>

    <!-- ══════════════════════════════════════ -->
    <!-- SECTION: SYSTEM INTERNALS              -->
    <!-- ══════════════════════════════════════ -->
    <div class="section" id="sec-internals">
      <div class="card-d">
        <h2><i class="fas fa-microscope" style="color:var(--lime)"></i> System Internals — What Runs Inside Each Section</h2>
        <p style="font-size:.82rem;color:var(--muted);margin-bottom:12px">Explore the data flows, models, workflows, and internal logic powering every part of the BANF ecosystem.</p>
        <div class="int-tabs" id="int-tabs"></div>
        <div id="int-panels"></div>
      </div>
    </div>

    <!-- ══════════════════════════════════════ -->
    <!-- SECTION: EXPERT REVIEW ORCHESTRATION   -->
    <!-- ══════════════════════════════════════ -->
    <div class="section" id="sec-experts">
      <div class="card-d">
        <h2><i class="fas fa-users-gear" style="color:var(--pink)"></i> 9-Expert Agent Review Orchestration</h2>
        <p style="font-size:.82rem;color:var(--muted);margin-bottom:14px">Every section is reviewed by 9 specialist agents. Audit trail shows what they flagged and how issues were addressed. LangGraph flows visualize progress.</p>
        <div class="expert-grid" id="expert-grid"></div>
      </div>

      <!-- LangGraph Per-Section Flows -->
      <div class="card-d">
        <h2><i class="fas fa-diagram-project" style="color:var(--pink)"></i> LangGraph Section Progress Flows</h2>
        <div class="exp-section-tabs" id="exp-section-tabs"></div>
        <div id="exp-section-panels"></div>
      </div>

      <!-- Audit Trail -->
      <div class="card-d">
        <h2><i class="fas fa-scroll" style="color:var(--yellow)"></i> Expert Audit Trail</h2>
        <div style="display:flex;gap:8px;margin-bottom:10px;flex-wrap:wrap">
          <select id="audit-expert-filter" style="background:var(--bg2);border:1px solid var(--line);color:var(--text);padding:4px 8px;border-radius:6px;font-size:.74rem">
            <option value="all">All Experts</option>
          </select>
          <select id="audit-status-filter" style="background:var(--bg2);border:1px solid var(--line);color:var(--text);padding:4px 8px;border-radius:6px;font-size:.74rem">
            <option value="all">All Status</option><option value="addressed">Addressed</option><option value="in-progress">In Progress</option><option value="pending">Pending</option><option value="deferred">Deferred</option>
          </select>
        </div>
        <div style="background:var(--bg);border:1px solid var(--line);border-radius:8px;max-height:400px;overflow-y:auto" id="audit-trail"></div>
      </div>
    </div>

    <!-- ══════════════════════════════════════ -->
    <!-- SECTION: REQUIREMENTS & DOCUMENTS       -->
    <!-- ══════════════════════════════════════ -->
    <div class="section" id="sec-requirements">
      <div class="kpi-grid" id="req-kpis"></div>
      <div class="card-d">
        <h2><i class="fas fa-file-lines" style="color:var(--blue)"></i> Requirements Documents & Artifacts</h2>
        <p style="font-size:.82rem;color:var(--muted);margin-bottom:14px">All project requirements, user profiles, goals, architecture documents, and Jira/ticket references linked from one place.</p>
        <div class="doc-grid" id="doc-grid"></div>
      </div>
      <div class="card-d">
        <h2><i class="fas fa-users" style="color:var(--purple)"></i> User Profiles & Goals</h2>
        <div id="user-profiles"></div>
      </div>
      <div class="card-d">
        <h2><i class="fas fa-ticket" style="color:var(--cyan)"></i> Jira / Ticket Board Summary</h2>
        <p style="font-size:.78rem;color:var(--muted);margin-bottom:10px">Tickets auto-generated from stakeholder acceptance notes and expert reviews flow here for development assignment.</p>
        <div id="jira-summary"></div>
      </div>
    </div>

    <!-- ══════════════════════════════════════ -->
    <!-- SECTION: DEVELOPMENT STATUS TRACKER     -->
    <!-- ══════════════════════════════════════ -->
    <div class="section" id="sec-devstatus">
      <div class="kpi-grid" id="devstat-kpis"></div>
      <div class="card-d">
        <h2><i class="fas fa-list-check" style="color:var(--green)"></i> Section-by-Section Development Status</h2>
        <p style="font-size:.82rem;color:var(--muted);margin-bottom:14px">Track which sections are completed, in-progress, remaining, or tested. Click any section for detail.</p>
        <div class="status-grid" id="status-grid"></div>
      </div>
      <div class="card-d">
        <h2><i class="fas fa-chart-pie" style="color:var(--accent)"></i> Overall Completion Matrix</h2>
        <table class="t" id="completion-matrix">
          <thead><tr><th>Section</th><th>Design</th><th>Implementation</th><th>Testing</th><th>Review</th><th>Accepted</th><th>Overall</th></tr></thead>
          <tbody id="completion-body"></tbody>
        </table>
      </div>
    </div>

    <!-- ══════════════════════════════════════ -->
    <!-- SECTION: STAKEHOLDER ACCEPTANCE         -->
    <!-- ══════════════════════════════════════ -->
    <div class="section" id="sec-acceptance">
      <div class="card-d">
        <h2><i class="fas fa-clipboard-check" style="color:var(--yellow)"></i> Stakeholder Acceptance Portal</h2>
        <p style="font-size:.82rem;color:var(--muted);margin-bottom:14px">Stakeholders, SMEs, and users can add acceptance notes per section, functionality, or workflow. Notes flow to Design → Ticket creation → Development.</p>
        <div class="note-form">
          <div style="display:flex;gap:8px;margin-bottom:10px;flex-wrap:wrap">
            <select id="note-section" style="flex:1;min-width:140px"><option value="">Select Section…</option></select>
            <select id="note-type" style="min-width:130px"><option value="acceptance">Acceptance Note</option><option value="feedback">Feedback</option><option value="requirement">New Requirement</option><option value="bug">Bug Report</option><option value="enhancement">Enhancement</option></select>
            <select id="note-priority" style="min-width:100px"><option value="medium">Medium</option><option value="high">High</option><option value="critical">Critical</option><option value="low">Low</option></select>
          </div>
          <div style="display:flex;gap:8px;margin-bottom:10px;flex-wrap:wrap">
            <input type="text" id="note-author" placeholder="Your Name (e.g. Ranadhir Ghosh)" style="flex:1;min-width:180px">
            <input type="text" id="note-target" placeholder="Specific functionality (optional)" style="flex:1;min-width:180px">
          </div>
          <textarea id="note-body" placeholder="Enter your acceptance note, feedback, or requirement here…\n\nThis will flow to: Design Review → Ticket Creation → Development Sprint"></textarea>
          <div style="display:flex;align-items:center;justify-content:space-between;margin-top:8px">
            <span style="font-size:.72rem;color:var(--dim)"><i class="fas fa-route me-1"></i>Flow: Note → Expert Review → Design → Ticket → Sprint Assignment</span>
            <button class="btn-submit" id="note-submit"><i class="fas fa-paper-plane me-1"></i>Submit Note</button>
          </div>
        </div>
      </div>
      <div class="card-d">
        <h2><i class="fas fa-history" style="color:var(--muted)"></i> Acceptance History & Ticket Flow</h2>
        <div style="display:flex;gap:8px;margin-bottom:10px;flex-wrap:wrap">
          <select id="history-filter-section" style="background:var(--bg2);border:1px solid var(--line);color:var(--text);padding:4px 8px;border-radius:6px;font-size:.74rem"><option value="all">All Sections</option></select>
          <select id="history-filter-status" style="background:var(--bg2);border:1px solid var(--line);color:var(--text);padding:4px 8px;border-radius:6px;font-size:.74rem"><option value="all">All Status</option><option value="submitted">Submitted</option><option value="in-review">In Review</option><option value="ticket-created">Ticket Created</option><option value="in-development">In Development</option><option value="completed">Completed</option></select>
        </div>
        <div class="note-history" id="note-history"></div>
      </div>
    </div>

    <!-- ══════════════════════════════════════ -->
    <!-- SECTION: DEVELOPMENT AGENT TEAM         -->
    <!-- ══════════════════════════════════════ -->
    <div class="section" id="sec-devteam">
      <div class="card-d">
        <h2><i class="fas fa-people-group" style="color:var(--teal)"></i> Development Agent Team</h2>
        <p style="font-size:.82rem;color:var(--muted);margin-bottom:14px">Specialist development agents with diverse skill sets. Tickets from stakeholder acceptance flow here for implementation under Tech Lead supervision.</p>
        <div class="dev-team-grid" id="dev-team-grid"></div>
      </div>
      <div class="card-d">
        <h2><i class="fas fa-ticket" style="color:var(--blue)"></i> Active Development Tickets</h2>
        <p style="font-size:.78rem;color:var(--muted);margin-bottom:10px">Stakeholder notes → Design review → Tickets auto-assigned to agents based on skill match. Tech Lead (Super Admin) approves all implementations.</p>
        <div class="ticket-board" id="ticket-board"></div>
      </div>
      <div class="card-d">
        <h2><i class="fas fa-diagram-project" style="color:var(--accent)"></i> SE Process Flow</h2>
        <div class="flow-diagram">
          <div class="flow-node input"><i class="fas fa-clipboard-check me-1"></i>Stakeholder Note</div>
          <span class="flow-arrow"><i class="fas fa-arrow-right"></i></span>
          <div class="flow-node agent"><i class="fas fa-users-gear me-1"></i>Expert Review</div>
          <span class="flow-arrow"><i class="fas fa-arrow-right"></i></span>
          <div class="flow-node process"><i class="fas fa-drafting-compass me-1"></i>Design</div>
          <span class="flow-arrow"><i class="fas fa-arrow-right"></i></span>
          <div class="flow-node process"><i class="fas fa-ticket me-1"></i>Ticket Created</div>
          <span class="flow-arrow"><i class="fas fa-arrow-right"></i></span>
          <div class="flow-node agent"><i class="fas fa-robot me-1"></i>Agent Assigned</div>
          <span class="flow-arrow"><i class="fas fa-arrow-right"></i></span>
          <div class="flow-node store"><i class="fas fa-code me-1"></i>Implementation</div>
          <span class="flow-arrow"><i class="fas fa-arrow-right"></i></span>
          <div class="flow-node process"><i class="fas fa-vial me-1"></i>Testing</div>
          <span class="flow-arrow"><i class="fas fa-arrow-right"></i></span>
          <div class="flow-node output"><i class="fas fa-check-double me-1"></i>Tech Lead Approval</div>
        </div>
        <p style="font-size:.76rem;color:var(--dim);margin-top:8px"><i class="fas fa-shield-alt me-1" style="color:var(--red)"></i>All implementations require Tech Lead (Super Admin: Ranadhir Ghosh) final approval before deployment.</p>
      </div>
    </div>

  </div><!-- /content -->
</div><!-- /main -->

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script>
// ═══════════════════════════════════════════════════════════════════
//  DATA DEFINITIONS
// ═══════════════════════════════════════════════════════════════════

const BASE = 'https://banfwix.wixsite.com/banf1/_functions';
const ADMIN_KEY = 'banf-super-admin-2026';

// ── Lifecycle Agents ──
const LIFECYCLE_AGENTS = [
  {id:'req-agent',name:'Requirements Agent',stage:'Requirements',color:'#3b82f6',icon:'fa-clipboard-list',
   caps:['intake_classify','priority_score','decompose_stories','detect_gaps','trace_link'],gate:'PO approves priority'},
  {id:'des-agent',name:'Design Agent',stage:'Design',color:'#a855f7',icon:'fa-drafting-compass',
   caps:['api_contract_gen','schema_design','adr_draft','impact_analysis'],gate:'Architect review'},
  {id:'dev-agent',name:'Development Agent',stage:'Development',color:'#22c55e',icon:'fa-code',
   caps:['scaffold_code','pr_review','dependency_check','refactor_suggest','lint_check'],gate:'PR reviewer'},
  {id:'tst-agent',name:'Testing Agent',stage:'Testing',color:'#eab308',icon:'fa-vial',
   caps:['test_plan_gen','execute_tests','regression_detect','coverage_map','flaky_detect'],gate:'QA sign-off'},
  {id:'dpl-agent',name:'Deployment Agent',stage:'Deployment',color:'#f97316',icon:'fa-rocket',
   caps:['gate_check','wix_publish','health_verify','rollback','changelog'],gate:'DevOps approval'},
  {id:'ops-agent',name:'Operations Agent',stage:'Operations',color:'#ef4444',icon:'fa-heartbeat',
   caps:['health_monitor','incident_detect','slo_track','runbook_execute','feedback_loop'],gate:'SRE escalation'},
  {id:'mlo-agent',name:'MLOps Agent',stage:'MLOps',color:'#06b6d4',icon:'fa-brain',
   caps:['model_eval','prompt_version','rag_drift','guardrails','ab_test','token_budget'],gate:'ML engineer review'},
];

// ── Domain Agents ──
const DOMAIN_AGENTS = [
  {id:'events-agent',name:'Events Coordinator',stage:'CRM',color:'#ec4899',icon:'fa-calendar-alt',
   caps:['event_info','registration','rsvp','payment_info'],gate:'—'},
  {id:'membership-agent',name:'Membership Services',stage:'CRM',color:'#8b5cf6',icon:'fa-id-card',
   caps:['join_process','benefits_info','dues_info','renewal'],gate:'—'},
  {id:'payment-agent',name:'Treasurer / Payment',stage:'CRM',color:'#14b8a6',icon:'fa-wallet',
   caps:['payment_methods','zelle_venmo','verification','receipts'],gate:'—'},
  {id:'complaint-agent',name:'Complaint Resolution',stage:'CRM',color:'#f43f5e',icon:'fa-exclamation-circle',
   caps:['intake','acknowledge','track','escalate'],gate:'EC review'},
  {id:'sponsorship-agent',name:'Sponsorship Coordinator',stage:'CRM',color:'#84cc16',icon:'fa-handshake',
   caps:['tier_info','customization','invoicing','recognition'],gate:'—'},
  {id:'career-agent',name:'Career Services',stage:'CRM',color:'#0ea5e9',icon:'fa-briefcase',
   caps:['resume_review','job_referrals','networking','sessions'],gate:'—'},
  {id:'general-agent',name:'General Information',stage:'CRM',color:'#a3a3a3',icon:'fa-info-circle',
   caps:['faq','routing','org_info','directing'],gate:'—'},
];

// ── Endpoint Groups ──
const EP_GROUPS = [
  {name:'Admin API',badge:'orange',eps:[
    {m:'GET',n:'admin_dashboard'},{m:'GET',n:'admin_members'},{m:'POST',n:'admin_member_update'},{m:'POST',n:'admin_member_deactivate'},
    {m:'GET',n:'admin_payments'},{m:'POST',n:'admin_payment_update'},{m:'POST',n:'admin_payment_record'},
    {m:'GET',n:'admin_vendors'},{m:'POST',n:'admin_vendor'},{m:'GET',n:'admin_sponsors'},{m:'POST',n:'admin_sponsor'},
    {m:'GET',n:'admin_ads'},{m:'POST',n:'admin_ad'},{m:'GET',n:'admin_careers'},{m:'POST',n:'admin_career_session'},
    {m:'GET',n:'admin_archive'},{m:'GET',n:'admin_email_queue'},{m:'POST',n:'admin_email_scan'},
    {m:'POST',n:'admin_approve_response'},{m:'GET',n:'admin_auto_responses'},
    {m:'GET',n:'admin_knowledge_base'},{m:'POST',n:'admin_kb_add'},{m:'POST',n:'admin_kb_upload'},{m:'POST',n:'admin_kb_search'},
    {m:'GET',n:'admin_agents'},{m:'POST',n:'admin_agent_update'},
    {m:'GET',n:'admin_roles'},{m:'POST',n:'admin_role_add'},{m:'POST',n:'admin_role_revoke'},
    {m:'POST',n:'admin_onboard_verify'},{m:'POST',n:'admin_set_password'},{m:'POST',n:'admin_save_profile'},
    {m:'POST',n:'admin_onboard_complete'},{m:'POST',n:'admin_verify_login'},{m:'POST',n:'admin_pwdebug'},
    {m:'GET',n:'email_templates'},{m:'POST',n:'email_template_save'},{m:'POST',n:'admin_bootstrap'},
    {m:'GET',n:'ec_onboard_dashboard'},{m:'POST',n:'ec_feature_config'},{m:'GET',n:'ec_feature_config'}
  ]},
  {name:'CRM API',badge:'purple',eps:[
    {m:'GET',n:'crm_dashboard'},{m:'GET',n:'crm_families'},{m:'GET',n:'crm_family'},{m:'POST',n:'crm_family_create'},
    {m:'POST',n:'crm_family_update'},{m:'GET',n:'crm_family_history'},{m:'POST',n:'crm_adult_add'},{m:'POST',n:'crm_adult_remove'},
    {m:'POST',n:'crm_minor_add'},{m:'POST',n:'crm_minor_remove'},{m:'GET',n:'crm_member'},{m:'GET',n:'crm_member_search'},
    {m:'POST',n:'crm_member_update'},{m:'GET',n:'crm_member_report'},{m:'GET',n:'crm_members'},
    {m:'POST',n:'crm_org_role_add'},{m:'GET',n:'crm_org_roles'},{m:'POST',n:'crm_award_add'},{m:'GET',n:'crm_awards'},
    {m:'POST',n:'crm_volunteer_add'},{m:'GET',n:'crm_volunteer'},{m:'GET',n:'crm_member_comms'},
    {m:'GET',n:'crm_member_payments'},{m:'POST',n:'crm_seed'},{m:'POST',n:'crm_link_emails'}
  ]},
  {name:'Member API',badge:'green',eps:[
    {m:'GET',n:'member_profile'},{m:'POST',n:'member_profile_update'},{m:'GET',n:'member_payments'},
    {m:'GET',n:'member_events'},{m:'POST',n:'member_rsvp'},{m:'GET',n:'member_complaints'},
    {m:'POST',n:'member_complaint_submit'},{m:'GET',n:'member_surveys'},{m:'POST',n:'member_chat'},
    {m:'POST',n:'member_chat_context'},{m:'GET',n:'member_directory'}
  ]},
  {name:'RAG / Knowledge',badge:'cyan',eps:[
    {m:'GET',n:'rag_search'},{m:'GET',n:'rag_context'},{m:'GET',n:'rag_knowledge_stats'},
    {m:'GET',n:'rag_categories'},{m:'GET',n:'rag_documents'},{m:'GET',n:'rag_chunk'},
    {m:'POST',n:'rag_ask'},{m:'GET',n:'rag_comms_analyze'},{m:'POST',n:'rag_comms_categorize'},
    {m:'GET',n:'rag_member_insights'},{m:'GET',n:'rag_sensitivity_map'}
  ]},
  {name:'Evite System',badge:'pink',eps:[
    {m:'POST',n:'evite_create_event'},{m:'GET',n:'evite_events'},{m:'POST',n:'evite_scan'},
    {m:'GET',n:'evite_attendance_report'},{m:'POST',n:'evite_parse_single'},{m:'POST',n:'evite_rsvp_override'},
    {m:'GET',n:'evite_rsvps'},{m:'POST',n:'evite_send_invites'},{m:'GET',n:'evite_rsvp_form_data'},
    {m:'POST',n:'evite_rsvp_submit'},{m:'GET',n:'evite_invite_status'}
  ]},
  {name:'Survey Engine',badge:'blue',eps:[
    {m:'POST',n:'survey_setup'},{m:'POST',n:'survey_create'},{m:'GET',n:'survey_list'},
    {m:'GET',n:'survey_detail'},{m:'GET',n:'survey_test_members'},{m:'POST',n:'survey_send'},
    {m:'GET',n:'survey_form'},{m:'GET',n:'survey_form_data'},{m:'POST',n:'survey_submit'},
    {m:'POST',n:'survey_process'},{m:'GET',n:'survey_report'},{m:'GET',n:'survey_escalations'},
    {m:'POST',n:'survey_resolve_escalation'},{m:'POST',n:'survey_close'},{m:'POST',n:'survey_process_email'}
  ]},
  {name:'Membership Drive',badge:'yellow',eps:[
    {m:'GET',n:'membership_tiers'},{m:'POST',n:'membership_recommend'},{m:'POST',n:'membership_register'},
    {m:'GET',n:'membership_status'},{m:'GET',n:'membership_test_pay'},{m:'POST',n:'membership_confirm_payment'},
    {m:'GET',n:'membership_registrations'},{m:'POST',n:'membership_parse_config'},{m:'POST',n:'membership_config_save'},
    {m:'GET',n:'membership_config'},{m:'GET',n:'membership_universe'},{m:'POST',n:'membership_universe_update'},
    {m:'POST',n:'membership_drive_init'},{m:'GET',n:'membership_drive_status'},{m:'POST',n:'membership_drive_notify'},
    {m:'POST',n:'membership_drive_control'},{m:'GET',n:'membership_history'},{m:'POST',n:'membership_compare'}
  ]},
  {name:'Google Drive',badge:'green',eps:[
    {m:'GET',n:'gdrive_auth_url'},{m:'GET',n:'gdrive_list'},{m:'GET',n:'gdrive_file'},
    {m:'POST',n:'gdrive_sync_csv'},{m:'GET',n:'gdrive_search'},{m:'GET',n:'gdrive_status'},
    {m:'POST',n:'gdrive_find_banf_folder'}
  ]},
  {name:'Data Mapper',badge:'blue',eps:[
    {m:'POST',n:'bulk_import_members'},{m:'POST',n:'bulk_import_org_roles'},{m:'POST',n:'gmail_full_link'},
    {m:'GET',n:'import_status'},{m:'POST',n:'full_data_sync'}
  ]},
  {name:'EC Onboarding',badge:'red',eps:[
    {m:'GET',n:'ec_year_status'},{m:'POST',n:'ec_year_complete'},{m:'POST',n:'ec_year_reset'},
    {m:'GET',n:'ec_onboard_progress'},{m:'GET',n:'membership_gate_check'},{m:'POST',n:'ec_send_reminder'},
    {m:'GET',n:'ec_pending_members'}
  ]},
  {name:'Archive Mapper',badge:'purple',eps:[
    {m:'GET',n:'archive_catalog'},{m:'POST',n:'archive_map'},{m:'GET',n:'archive_map_report'},
    {m:'POST',n:'archive_map_update'},{m:'GET',n:'gdrive_archive_scan'},{m:'GET',n:'gmail_archive_scan'},
    {m:'POST',n:'archive_full_scan'},{m:'POST',n:'archive_setup'},{m:'GET',n:'archive_setup'},
    {m:'POST',n:'archive_doc_delete'},{m:'POST',n:'archive_doc_add'}
  ]},
  {name:'Comms Correction',badge:'orange',eps:[
    {m:'POST',n:'comms_correction_launch'},{m:'GET',n:'comms_correction_status'},{m:'GET',n:'comms_correction_form'},
    {m:'GET',n:'comms_form_html'},{m:'GET',n:'comms_form_data'},{m:'POST',n:'comms_correction_submit'},
    {m:'POST',n:'comms_correction_decline'},{m:'POST',n:'comms_correction_reset_test'},
    {m:'GET',n:'comms_correction_dashboard'},{m:'GET',n:'comms_dashboard_data'},{m:'GET',n:'comms_family_universe'}
  ]},
  {name:'Zelle Payments',badge:'green',eps:[
    {m:'GET',n:'zelle_stats'},{m:'GET',n:'zelle_payments'},{m:'POST',n:'zelle_scan'},
    {m:'GET',n:'zelle_poller'},{m:'POST',n:'zelle_verify'},{m:'POST',n:'zelle_reject'},
    {m:'GET',n:'zelle_members'},{m:'POST',n:'zelle_match'},{m:'POST',n:'zelle_seed'},{m:'GET',n:'zelle_history'}
  ]},
  {name:'Landing / Pages',badge:'dim',eps:[
    {m:'GET',n:'landing_data'},{m:'GET',n:'landing_seed'},{m:'GET',n:'landing_test'},
    {m:'GET',n:'health'},{m:'GET',n:'home'},{m:'GET',n:'member_portal'},{m:'GET',n:'admin_portal'},
    {m:'GET',n:'crm_admin'},{m:'GET',n:'join'},{m:'GET',n:'membership_admin'},
    {m:'GET',n:'archive_mapping'},{m:'GET',n:'archive_scan_report'},{m:'GET',n:'membership_drive_workflow'},
    {m:'GET',n:'reconciliation_workflow'},{m:'GET',n:'ec_onboard_dashboard_page'}
  ]},
  {name:'Computer Agent / Tests',badge:'cyan',eps:[
    {m:'POST',n:'computer_agent_test'},{m:'GET',n:'computer_agent_report'},{m:'GET',n:'computer_agent_status'},
    {m:'POST',n:'run_test_suite'},{m:'GET',n:'test_results'}
  ]},
];

// ── Existing Collections ──
const EXISTING_COLLECTIONS = [
  {name:'Members',fields:['email','firstName','lastName','familyId','role','status']},
  {name:'FamilyUnits',fields:['familyId','familyName','adults','children','primaryEmail']},
  {name:'Events',fields:['title','date','location','type','budget','status']},
  {name:'Sponsors',fields:['name','tier','amount','year','contactEmail']},
  {name:'Magazine',fields:['title','edition','content','date']},
  {name:'RadioSchedule',fields:['day','time','host','genre','description']},
  {name:'Announcements',fields:['title','message','date','priority']},
  {name:'Volunteers',fields:['name','email','role','event','hours']},
  {name:'AdminRoles',fields:['memberId','role','permissions','grantedBy']},
  {name:'AdminActivityLog',fields:['actor','action','target','timestamp']},
  {name:'AgentProfiles',fields:['agentId','name','category','systemPrompt','config']},
  {name:'KnowledgeBase',fields:['title','content','category','sensitivity']},
  {name:'EmailQueue',fields:['to','subject','body','status','sentAt']},
  {name:'AutoResponses',fields:['trigger','response','agentId','approved']},
  {name:'Payments',fields:['memberId','amount','method','purpose','date']},
  {name:'ECMembers',fields:['name','title','email','order','year']},
  {name:'ECYearStatus',fields:['year','status','completedSteps','completedAt']},
  {name:'MembershipPlans',fields:['name','price','features','active']},
  {name:'SponsorshipTiers',fields:['tierName','amount','benefits']},
  {name:'SiteStats',fields:['key','value','updatedAt']},
  {name:'BudgetSummary',fields:['year','income','expenses','balance']},
  {name:'SiteContent',fields:['section','content','updatedAt']},
  {name:'SurveyDefinitions',fields:['title','questions','status','year']},
  {name:'SurveyResponses',fields:['surveyId','memberId','answers','submittedAt']},
  {name:'EviteEvents',fields:['eventId','title','date','invitees']},
  {name:'RSVPs',fields:['eventId','memberId','status','guests']},
  {name:'Complaints',fields:['memberId','subject','body','status','assignee']},
  {name:'ArchiveDocuments',fields:['title','type','driveId','category']},
  {name:'CommsCorrectionDrive',fields:['memberId','status','corrections']},
];

const NEW_COLLECTIONS = [
  {name:'WorkLedger',desc:'Core work items across all lifecycle stages',fields:['workItemId','type','status','priority','ownerAgent','currentStage','correlationId','traceLinks']},
  {name:'AgentEventLog',desc:'Inter-agent event bus for dashboard sync',fields:['eventType','sourceAgent','targetAgent','workItemId','payload','correlationId','status']},
  {name:'AgentMetrics',desc:'Agent performance telemetry',fields:['agentId','metricType','value','unit','window','timestamp']},
  {name:'DeploymentLedger',desc:'Release history and rollback audit trail',fields:['deployId','version','status','healthCheckResult','rollbackPath','changelog']},
  {name:'TestRunLedger',desc:'Test execution results and coverage tracking',fields:['runId','testPlanId','results','coverageScore','regressions','gateReady']},
  {name:'PromptRegistry',desc:'Versioned LLM prompt management',fields:['promptId','agentId','version','systemPrompt','status','evalScore']},
];

// ── Role Dashboard Config ──
const ROLES = {
  stakeholder:{name:'Stakeholder',icon:'fa-chart-pie',color:'#f97316',widgets:[
    {title:'Requirements Board',desc:'Prioritized backlog with agent-scored rankings',icon:'fa-list-check'},
    {title:'Release Timeline',desc:'Gantt-style view: epics → sprints → deploy dates',icon:'fa-calendar-alt'},
    {title:'KPI Scoreboard',desc:'Velocity, coverage, open risks — 15 min refresh',icon:'fa-tachometer-alt'},
    {title:'Feedback Inbox',desc:'User feedback auto-classified by req-agent',icon:'fa-comments'},
    {title:'Risk Register',desc:'Active risks with severity, owner, mitigation',icon:'fa-exclamation-triangle'},
    {title:'Notifications',desc:'Digest emails + in-dashboard gate approval alerts',icon:'fa-bell'},
  ]},
  developer:{name:'Developer',icon:'fa-code',color:'#22c55e',widgets:[
    {title:'Sprint Board',desc:'Kanban with auto-assignment from dev-agent',icon:'fa-columns'},
    {title:'PR / Commit Activity',desc:'Git feed with agent review comments',icon:'fa-code-branch'},
    {title:'Code Quality Trends',desc:'Module-level quality scores tracked over time',icon:'fa-chart-bar'},
    {title:'Build Status',desc:'Real-time publish pipeline progress',icon:'fa-hammer'},
    {title:'My Items',desc:'Personal task list from WorkLedger',icon:'fa-tasks'},
    {title:'Traceability',desc:'Full lifecycle: REQ → DES → TST → DPL',icon:'fa-link'},
  ]},
  tester:{name:'Tester',icon:'fa-vial',color:'#eab308',widgets:[
    {title:'Test Run Results',desc:'Latest execution with pass/fail/skip',icon:'fa-play-circle'},
    {title:'Coverage Matrix',desc:'Requirement → Test → Result traceability',icon:'fa-project-diagram'},
    {title:'Defect Board',desc:'Open defects auto-classified by severity',icon:'fa-bug'},
    {title:'Regression Trend',desc:'Historical pass rates with detection',icon:'fa-chart-line'},
    {title:'Flaky Test Watch',desc:'Non-deterministic tests flagged',icon:'fa-random'},
    {title:'Release Gate',desc:'Green/red gate status for readiness',icon:'fa-door-open'},
  ]},
  devops:{name:'DevOps',icon:'fa-server',color:'#ef4444',widgets:[
    {title:'Pipeline Status',desc:'Live build → test → publish → health',icon:'fa-stream'},
    {title:'Endpoint Health',desc:'196-endpoint matrix with latency/errors',icon:'fa-server'},
    {title:'Deploy History',desc:'Version timeline with rollback paths',icon:'fa-history'},
    {title:'Incident Board',desc:'Active incidents with runbook progress',icon:'fa-fire-alt'},
    {title:'SLO Tracker',desc:'Availability, p95 latency, error budget',icon:'fa-bullseye'},
    {title:'Rollback Control',desc:'One-click rollback with health verification',icon:'fa-undo'},
  ]},
  mlops:{name:'MLOps',icon:'fa-brain',color:'#06b6d4',widgets:[
    {title:'Model Performance',desc:'Accuracy, relevance, latency per agent',icon:'fa-chart-pie'},
    {title:'Prompt Registry',desc:'Version-controlled prompts with A/B compare',icon:'fa-scroll'},
    {title:'RAG Drift Monitor',desc:'Knowledge freshness and staleness alerts',icon:'fa-wave-square'},
    {title:'Guardrail Log',desc:'Triggered safety rules and blocked outputs',icon:'fa-shield-alt'},
    {title:'Token Budget',desc:'Daily token usage vs budget per agent',icon:'fa-coins'},
    {title:'Shadow Eval',desc:'Side-by-side prompt version comparison',icon:'fa-flask'},
  ]},
  security:{name:'Security',icon:'fa-shield-alt',color:'#a855f7',widgets:[
    {title:'Audit Trail',desc:'All privileged actions with actor/outcome',icon:'fa-scroll'},
    {title:'AuthZ Matrix',desc:'Route-permission mapping with violations',icon:'fa-user-shield'},
    {title:'Secrets Health',desc:'Rotation status and credential age',icon:'fa-key'},
    {title:'AI Safety',desc:'Guardrail triggers, moderation health',icon:'fa-robot'},
    {title:'Vulnerability Board',desc:'Dependency and config risk findings',icon:'fa-exclamation-circle'},
    {title:'Incident Response',desc:'Active incidents with runbook status',icon:'fa-bolt'},
  ]},
};

// ── Sprint Data ──
const SPRINTS = [
  {name:'Sprint 1 (Wk 1–2)',items:[
    {id:'STY-01',title:'Rotate Secrets to Wix Secrets Manager',pts:5},
    {id:'STY-02',title:'Granular Collection Permissions',pts:8},
    {id:'STY-03',title:'Sensitivity-Based Access Controls',pts:5},
    {id:'STY-04',title:'Daily Encrypted Backup Job',pts:8},
  ]},
  {name:'Sprint 2 (Wk 3–4)',items:[
    {id:'STY-05',title:'Collection afterInsert Hooks',pts:5},
    {id:'STY-06',title:'Replace Polling with Event Bus',pts:8},
    {id:'STY-07',title:'HuggingFace Inference Endpoints',pts:5},
    {id:'STY-08',title:'Agent Self-Evaluation Loop',pts:5},
  ]},
  {name:'Sprint 3 (Wk 5–6)',items:[
    {id:'STY-09',title:'Velo CLI Automation Pipeline',pts:5},
    {id:'STY-10',title:'Multi-Revision Preview Slots',pts:5},
    {id:'STY-11',title:'Automated Regression Suite',pts:5},
    {id:'STY-12',title:'Unified Observability Pipeline',pts:5},
  ]},
  {name:'Sprint 4 (Wk 7–8)',items:[
    {id:'STY-13',title:'wixData Batch + Index Tuning',pts:5},
    {id:'STY-14',title:'LLM Token Cost Guard',pts:3},
    {id:'STY-15',title:'Responsive + Accessibility Audit',pts:5},
  ]},
  {name:'Sprint 5 (Wk 9–10)',items:[
    {id:'STY-16',title:'Multi-Language Support',pts:5},
    {id:'STY-17',title:'Predictive Analytics Dashboard',pts:3},
  ]},
  {name:'Sprint 6 (Wk 11–12)',items:[
    {id:'STY-18',title:'Operational Runbooks & ADRs',pts:3},
  ]},
];

// ── Quick Links ──
const LINKS = [
  {title:'Live Site',desc:'banfwix.wixsite.com/banf1',url:'https://banfwix.wixsite.com/banf1',icon:'fa-globe',color:'var(--green)'},
  {title:'Health Check',desc:'API health endpoint',url:'https://banfwix.wixsite.com/banf1/_functions/health',icon:'fa-heartbeat',color:'var(--green)'},
  {title:'Stakeholder Journey',desc:'Requirements lifecycle tracker',url:'stakeholder-requirements-journey.html',icon:'fa-route',color:'var(--indigo)'},
  {title:'EC Onboarding',desc:'EC gate chain dashboard',url:'ec-onboard-dashboard.html',icon:'fa-shield-alt',color:'var(--red)'},
  {title:'Comms Dashboard',desc:'Communications correction drive',url:'comms-dashboard.html',icon:'fa-envelope',color:'var(--blue)'},
  {title:'Browser Agent Report',desc:'Playwright + LLM test results',url:'banf-browser-agent-report.html',icon:'fa-robot',color:'var(--cyan)'},
  {title:'Comprehensive Test Report',desc:'158 test full suite',url:'banf-comprehensive-report.html',icon:'fa-check-double',color:'var(--green)'},
  {title:'CRM Report',desc:'Member audit & data quality',url:'crm-comprehensive-report.html',icon:'fa-users',color:'var(--purple)'},
  {title:'System Architecture',desc:'Full architecture documentation',url:'BANF_SYSTEM_ARCHITECTURE.html',icon:'fa-sitemap',color:'var(--indigo)'},
  {title:'Agentic Platform',desc:'Agent mesh & lifecycle spec',url:'BANF_AGENTIC_PLATFORM.html',icon:'fa-atom',color:'var(--accent)'},
  {title:'Execution Backlog',desc:'Sprint-ready epics & stories',url:'BANF_EXECUTION_BACKLOG_PLAN.html',icon:'fa-tasks',color:'var(--yellow)'},
  {title:'Multi-Agent Critique',desc:'5-agent review report',url:'BANF_MULTI_AGENT_CRITIQUE_REPORT.html',icon:'fa-magnifying-glass',color:'var(--pink)'},
  {title:'Evite Report',desc:'Event invitation tracking',url:'evite-report.html',icon:'fa-calendar-check',color:'var(--teal)'},
  {title:'Survey Admin',desc:'Survey creation & analysis',url:'survey-admin.html',icon:'fa-poll',color:'var(--lime)'},
  {title:'Family Fix Report',desc:'Family ID dedup results',url:'family-fix-report.html',icon:'fa-house-user',color:'var(--yellow)'},
  {title:'GitHub Repository',desc:'Source code on GitHub',url:'https://github.com',icon:'fa-brands fa-github',color:'var(--muted)'},
  {title:'Wix Dashboard',desc:'Wix site management',url:'https://manage.wix.com',icon:'fab fa-wix',color:'var(--blue)'},
  {title:'Super Admin Portal',desc:'Login, user management, drives',url:'https://banfwix.wixsite.com/banf1/_functions/admin_portal',icon:'fa-shield-alt',color:'var(--red)'},
];

// ═══════════════════════════════════════════════════════════════════
//  RENDERING
// ═══════════════════════════════════════════════════════════════════

function renderKPIs() {
  const el = document.getElementById('kpi-row');
  const kpis = [
    {v:'196',k:'API Endpoints',cls:'orange'},
    {v:'14',k:'AI Agents',cls:'cyan'},
    {v:'40+',k:'Collections',cls:'purple'},
    {v:'36+',k:'Backend Modules',cls:'blue'},
    {v:'270',k:'Total Tests',cls:'green'},
    {v:'v5.10.1',k:'Current Version',cls:'yellow'},
    {v:'5',k:'RBAC Roles',cls:'red'},
    {v:'6.7K',k:'LOC (Router)',cls:'pink'},
  ];
  el.innerHTML = kpis.map(k=>`<div class="kpi ${k.cls}"><div class="v">${k.v}</div><div class="k">${k.k}</div></div>`).join('');
}

function renderAgents(agents, containerId) {
  const el = document.getElementById(containerId);
  el.innerHTML = agents.map(a=>`
    <div class="agent-card">
      <div class="a-hdr">
        <div class="a-icon" style="background:${a.color}22;color:${a.color}"><i class="fas ${a.icon}"></i></div>
        <div><div class="a-name">${a.name}</div><div class="a-stage">${a.stage} &bull; ${a.id}</div></div>
      </div>
      <div class="a-caps">${a.caps.map(c=>`<span class="a-cap">${c}</span>`).join('')}</div>
      ${a.gate !== '—' ? `<div class="a-gate"><i class="fas fa-lock me-1"></i>${a.gate}</div>` : ''}
    </div>
  `).join('');
}

function renderEndpoints() {
  const list = document.getElementById('ep-list');
  list.innerHTML = EP_GROUPS.map((g,i)=>`
    <div class="ep-group">
      <div class="ep-group-hdr" onclick="this.classList.toggle('open');this.nextElementSibling.classList.toggle('open')">
        <span class="badge-s badge-${g.badge} me-2">${g.eps.length}</span>
        <span class="ep-name">${g.name}</span>
        <span class="ep-arrow"><i class="fas fa-chevron-right"></i></span>
      </div>
      <div class="ep-body">
        ${g.eps.map(e=>`<div class="ep-item"><span class="ep-method ${e.m.toLowerCase()}">${e.m}</span> /${e.n}</div>`).join('')}
      </div>
    </div>
  `).join('');

  document.getElementById('ep-search').addEventListener('input', function(){
    const q = this.value.toLowerCase();
    document.querySelectorAll('.ep-group').forEach(g => {
      const items = g.querySelectorAll('.ep-item');
      let vis = 0;
      items.forEach(item => {
        const show = item.textContent.toLowerCase().includes(q);
        item.style.display = show ? '' : 'none';
        if(show) vis++;
      });
      g.style.display = vis || !q ? '' : 'none';
      if(q && vis) { g.querySelector('.ep-group-hdr').classList.add('open'); g.querySelector('.ep-body').classList.add('open'); }
    });
  });
}

function renderCollections() {
  const el1 = document.getElementById('existing-collections');
  el1.innerHTML = EXISTING_COLLECTIONS.map(c=>`
    <div class="coll-card">
      <h4>${c.name}</h4>
      <div class="coll-fields">${c.fields.map(f=>`<span class="coll-field">${f}</span>`).join('')}</div>
    </div>
  `).join('');

  const el2 = document.getElementById('new-collections');
  el2.innerHTML = NEW_COLLECTIONS.map(c=>`
    <div class="coll-card" style="border-left:3px solid var(--accent)">
      <h4>${c.name} <span class="badge-s badge-orange ms-2">NEW</span></h4>
      <div class="coll-desc">${c.desc}</div>
      <div class="coll-fields">${c.fields.map(f=>`<span class="coll-field">${f}</span>`).join('')}</div>
    </div>
  `).join('');
}

function renderSprints() {
  const el = document.getElementById('sprint-board');
  el.innerHTML = SPRINTS.map(s=>`
    <div class="sprint-col">
      <h5>${s.name}</h5>
      ${s.items.map(i=>`<div class="sprint-item"><span class="si-id">${i.id}</span> <span class="si-title">${i.title}</span><span class="si-pts">${i.pts}pt</span></div>`).join('')}
    </div>
  `).join('');
}

function renderRoles() {
  const tabsEl = document.getElementById('role-tabs');
  const panelsEl = document.getElementById('role-panels');
  const keys = Object.keys(ROLES);

  tabsEl.innerHTML = keys.map((k,i)=>{
    const r = ROLES[k];
    return `<div class="role-tab ${i===0?'active':''}" data-role="${k}"><i class="fas ${r.icon} me-1"></i>${r.name}</div>`;
  }).join('');

  panelsEl.innerHTML = keys.map((k,i)=>{
    const r = ROLES[k];
    return `<div class="role-panel ${i===0?'active':''}" id="rp-${k}">
      <div class="widget-grid">
        ${r.widgets.map(w=>`<div class="widget"><h6><i class="fas ${w.icon} me-1"></i>${w.title}</h6><p>${w.desc}</p></div>`).join('')}
      </div>
    </div>`;
  }).join('');

  tabsEl.querySelectorAll('.role-tab').forEach(tab => {
    tab.addEventListener('click', () => {
      tabsEl.querySelectorAll('.role-tab').forEach(t=>t.classList.remove('active'));
      panelsEl.querySelectorAll('.role-panel').forEach(p=>p.classList.remove('active'));
      tab.classList.add('active');
      document.getElementById('rp-'+tab.dataset.role).classList.add('active');
    });
  });
}

function renderLinks() {
  const el = document.getElementById('link-grid');
  el.innerHTML = LINKS.map(l=>`
    <a class="link-card" href="${l.url}" target="_blank">
      <div class="lc-icon" style="background:${l.color}22;color:${l.color}"><i class="fas ${l.icon}"></i></div>
      <div><div class="lc-title">${l.title}</div><div class="lc-desc">${l.desc}</div></div>
    </a>
  `).join('');
}

// ═══════════════════════════════════════════════════════════════════
//  LIVE DATA
// ═══════════════════════════════════════════════════════════════════

async function fetchHealth() {
  const dot = document.getElementById('health-dot');
  const txt = document.getElementById('health-text');
  const ver = document.getElementById('version-badge');
  const ref = document.getElementById('last-refresh');
  const gH = document.getElementById('gate-health');
  const gHB = document.getElementById('gate-health-badge');

  dot.className = 'status-dot loading';
  txt.textContent = 'Checking…';

  try {
    const r = await fetch(BASE + '/health', {signal: AbortSignal.timeout(10000)});
    const d = await r.json();
    if(d.status === 'healthy' || d.success) {
      dot.className = 'status-dot ok';
      txt.textContent = 'Healthy';
      ver.textContent = d.version || '—';
      if(gH) { gH.textContent = 'HTTP 200'; gHB.innerHTML = '<span class="badge-s badge-green">PASS</span>'; }
    } else {
      dot.className = 'status-dot err';
      txt.textContent = 'Degraded';
      if(gH) { gH.textContent = 'Non-200'; gHB.innerHTML = '<span class="badge-s badge-red">FAIL</span>'; }
    }
  } catch(e) {
    dot.className = 'status-dot err';
    txt.textContent = 'Unreachable';
    if(gH) { gH.textContent = 'Timeout'; gHB.innerHTML = '<span class="badge-s badge-red">FAIL</span>'; }
  }
  ref.textContent = new Date().toLocaleTimeString();
}

// ═══════════════════════════════════════════════════════════════════
//  OBSERVABILITY DATA + RENDERING
// ═══════════════════════════════════════════════════════════════════

const OTEL_LOGS = [
  {ts:'14:32:01',level:'info',svc:'http-router',trace:'t-8a3f',msg:'GET /health → 200 (12ms)'},
  {ts:'14:32:02',level:'info',svc:'agent-orch',trace:'t-8a3f',msg:'Orchestrator routing: general-agent selected for member query'},
  {ts:'14:32:03',level:'debug',svc:'rag-engine',trace:'t-8a40',msg:'TF-IDF search: 25 chunks scored, top-3 selected (relevance=0.87)'},
  {ts:'14:32:04',level:'info',svc:'wixData',trace:'t-8a41',msg:'Members.find() → 342 records, 45ms'},
  {ts:'14:32:05',level:'warn',svc:'email-svc',trace:'t-8a42',msg:'Gmail API rate limit approaching: 80/100 quota used'},
  {ts:'14:32:06',level:'error',svc:'http-router',trace:'t-8a43',msg:'POST /bulk_import_members → 500: wixData timeout after 30s'},
  {ts:'14:32:07',level:'info',svc:'auth-rbac',trace:'t-8a44',msg:'Role check: admin-member verified for /admin_dashboard'},
  {ts:'14:32:08',level:'info',svc:'evite-svc',trace:'t-8a45',msg:'Event "Bosonto Utsob 2026" created, 150 invites queued'},
  {ts:'14:32:09',level:'debug',svc:'agent-orch',trace:'t-8a46',msg:'HuggingFace inference: Llama-3.1-8B, 142 tokens, 380ms'},
  {ts:'14:32:10',level:'info',svc:'http-router',trace:'t-8a47',msg:'GET /crm_dashboard → 200 (89ms)'},
  {ts:'14:32:11',level:'warn',svc:'rag-engine',trace:'t-8a48',msg:'Knowledge chunk "bylaws-2024" stale: last updated 45 days ago'},
  {ts:'14:32:12',level:'info',svc:'wixData',trace:'t-8a49',msg:'Events.find() → 28 records, 22ms'},
  {ts:'14:32:13',level:'error',svc:'email-svc',trace:'t-8a50',msg:'Gmail OAuth token expired — refresh failed, manual re-auth needed'},
  {ts:'14:32:14',level:'info',svc:'http-router',trace:'t-8a51',msg:'GET /survey_list → 200 (34ms)'},
  {ts:'14:32:15',level:'info',svc:'agent-orch',trace:'t-8a52',msg:'complaint-agent escalation: P1 complaint → EC review queue'},
  {ts:'14:32:16',level:'debug',svc:'auth-rbac',trace:'t-8a53',msg:'Permission matrix: 40 rules evaluated, 0 violations'},
  {ts:'14:32:17',level:'info',svc:'http-router',trace:'t-8a54',msg:'POST /zelle_scan → 200 (156ms), 8 new payments matched'},
  {ts:'14:32:18',level:'warn',svc:'wixData',trace:'t-8a55',msg:'Collection "Members" approaching 10K row soft limit (9,247 rows)'},
  {ts:'14:32:19',level:'info',svc:'http-router',trace:'t-8a56',msg:'GET /ec_year_status → 200 (18ms)'},
  {ts:'14:32:20',level:'info',svc:'evite-svc',trace:'t-8a57',msg:'RSVP batch processed: 12 confirmations, 3 declines'},
];

const OTEL_TRACES = [
  {name:'Sample Trace: POST /member_chat',id:'t-8a3f',spans:[
    {svc:'http-router',label:'Route',start:0,width:100,color:'var(--blue)',dur:'245ms'},
    {svc:'auth-rbac',label:'AuthZ',start:2,width:8,color:'var(--purple)',dur:'18ms'},
    {svc:'agent-orch',label:'Orchestrate',start:12,width:80,color:'var(--cyan)',dur:'198ms'},
    {svc:'rag-engine',label:'RAG Search',start:16,width:25,color:'var(--green)',dur:'62ms'},
    {svc:'wixData',label:'DB Query',start:18,width:12,color:'var(--yellow)',dur:'28ms'},
    {svc:'HuggingFace',label:'LLM Infer',start:44,width:45,color:'var(--accent)',dur:'112ms'},
    {svc:'wixData',label:'Log Write',start:92,width:5,color:'var(--yellow)',dur:'12ms'},
  ]},
  {name:'Sample Trace: GET /admin_dashboard',id:'t-8a44',spans:[
    {svc:'http-router',label:'Route',start:0,width:100,color:'var(--blue)',dur:'89ms'},
    {svc:'auth-rbac',label:'AuthZ',start:1,width:10,color:'var(--purple)',dur:'9ms'},
    {svc:'wixData',label:'Members',start:12,width:30,color:'var(--yellow)',dur:'27ms'},
    {svc:'wixData',label:'Events',start:14,width:22,color:'var(--yellow)',dur:'20ms'},
    {svc:'wixData',label:'Payments',start:16,width:25,color:'var(--yellow)',dur:'22ms'},
    {svc:'wixData',label:'Aggregate',start:48,width:20,color:'var(--green)',dur:'18ms'},
  ]},
  {name:'Sample Trace: POST /evite_send_invites',id:'t-8a45',spans:[
    {svc:'http-router',label:'Route',start:0,width:100,color:'var(--blue)',dur:'1.2s'},
    {svc:'auth-rbac',label:'AuthZ',start:0.5,width:3,color:'var(--purple)',dur:'15ms'},
    {svc:'wixData',label:'Load Event',start:3,width:5,color:'var(--yellow)',dur:'32ms'},
    {svc:'wixData',label:'Load Members',start:4,width:8,color:'var(--yellow)',dur:'45ms'},
    {svc:'email-svc',label:'Batch Send',start:14,width:80,color:'var(--red)',dur:'980ms'},
    {svc:'wixData',label:'Log Status',start:96,width:3,color:'var(--yellow)',dur:'18ms'},
  ]},
];

const OTEL_METRICS = {
  latency:[
    {mod:'Admin API',val:89,max:300},{mod:'CRM API',val:120,max:300},{mod:'Member API',val:45,max:300},
    {mod:'RAG Engine',val:198,max:300},{mod:'Evite System',val:156,max:300},{mod:'Survey Engine',val:67,max:300},
    {mod:'Membership Drive',val:134,max:300},{mod:'Google Drive',val:210,max:300},{mod:'Zelle Payments',val:112,max:300},
    {mod:'EC Onboarding',val:38,max:300},{mod:'Archive Mapper',val:88,max:300},{mod:'Agent Orchestrator',val:245,max:300},
  ],
  errors:[
    {mod:'Admin API',val:0.2,max:5},{mod:'CRM API',val:0.5,max:5},{mod:'Member API',val:0.1,max:5},
    {mod:'RAG Engine',val:0.8,max:5},{mod:'Evite System',val:1.2,max:5},{mod:'Survey Engine',val:0.3,max:5},
    {mod:'Membership Drive',val:0.6,max:5},{mod:'Google Drive',val:2.1,max:5},{mod:'Zelle Payments',val:0.4,max:5},
    {mod:'EC Onboarding',val:0.0,max:5},{mod:'Archive Mapper',val:0.3,max:5},{mod:'Agent Orchestrator',val:1.5,max:5},
  ],
  throughput:[
    {mod:'Admin API',val:340,max:500},{mod:'CRM API',val:220,max:500},{mod:'Member API',val:180,max:500},
    {mod:'RAG Engine',val:95,max:500},{mod:'Evite System',val:60,max:500},{mod:'Survey Engine',val:45,max:500},
    {mod:'Membership Drive',val:120,max:500},{mod:'Google Drive',val:30,max:500},{mod:'Zelle Payments',val:55,max:500},
    {mod:'EC Onboarding',val:85,max:500},{mod:'Archive Mapper',val:40,max:500},{mod:'Landing Pages',val:410,max:500},
  ]
};

const OTEL_ALERTS = [
  {sev:'critical',name:'API Response Time > 2s',cond:'p95_latency > 2000ms',channel:'ops-agent → PagerDuty',status:'ok',statusColor:'green'},
  {sev:'critical',name:'Error Rate > 5%',cond:'error_rate > 5.0% (5min)',channel:'ops-agent → Slack #incidents',status:'ok',statusColor:'green'},
  {sev:'critical',name:'Health Endpoint Down',cond:'/health != 200 (2 checks)',channel:'ops-agent → auto-restart',status:'ok',statusColor:'green'},
  {sev:'warning',name:'Gmail Quota > 80%',cond:'gmail_quota_used > 80%',channel:'email-svc → ops-agent',status:'firing',statusColor:'yellow'},
  {sev:'warning',name:'DB Row Limit Approaching',cond:'collection.rows > 9000',channel:'wixData → ops-agent',status:'firing',statusColor:'yellow'},
  {sev:'warning',name:'RAG Chunk Staleness > 30d',cond:'chunk.lastUpdated > 30d',channel:'mlo-agent → notification',status:'firing',statusColor:'yellow'},
  {sev:'warning',name:'LLM Token Budget > 90%',cond:'daily_tokens > 90% budget',channel:'mlo-agent → throttle',status:'ok',statusColor:'green'},
  {sev:'info',name:'Deploy Success',cond:'deploy.status == success',channel:'dpl-agent → Slack #releases',status:'ok',statusColor:'green'},
  {sev:'info',name:'New P1 Complaint',cond:'complaint.priority == P1',channel:'complaint-agent → EC queue',status:'ok',statusColor:'green'},
  {sev:'info',name:'Test Suite Complete',cond:'test_run.finished == true',channel:'tst-agent → dashboard',status:'ok',statusColor:'green'},
];

const PROACTIVE_ITEMS = [
  {icon:'fa-database',color:'var(--yellow)',title:'Members collection approaching row limit',desc:'9,247 / 10,000 rows used. Recommendation: archive inactive members (pre-2020) to ArchiveDocuments collection. Estimated savings: ~2,100 rows.',action:'Archive Plan',priority:'Medium'},
  {icon:'fa-envelope',color:'var(--yellow)',title:'Gmail API quota exhaustion predicted in 2 hrs',desc:'Current usage trajectory: 80/100 daily quota at 2:32 PM. At current send rate (12/hr), limit reached by 4:30 PM. Recommendation: batch remaining sends or defer non-critical emails.',action:'Throttle Queue',priority:'Medium'},
  {icon:'fa-brain',color:'var(--cyan)',title:'RAG knowledge drift detected',desc:'3 knowledge chunks (bylaws-2024, membership-rules, ec-procedures) haven\'t been updated in 30+ days. Referenced in 34% of agent responses. Recommendation: schedule content refresh with SME review.',action:'Refresh Docs',priority:'Low'},
  {icon:'fa-clock',color:'var(--red)',title:'Google Drive sync latency spike pattern',desc:'p95 latency for gdrive_* endpoints increases 3x during 10-11 AM (concurrent user peak). Recommendation: pre-cache frequently accessed files or shift sync to off-peak.',action:'Pre-cache',priority:'High'},
  {icon:'fa-shield-alt',color:'var(--purple)',title:'OAuth token refresh failure pattern',desc:'Gmail OAuth refresh has failed 3 times in past 7 days. Token age: 89 days. Recommendation: proactively rotate credentials before next failure window.',action:'Rotate Token',priority:'High'},
  {icon:'fa-chart-line',color:'var(--green)',title:'Browser test pass rate trending up',desc:'Browser agent tests improved from 42% → 57% over last 3 runs. 8 previously flaky tests now stable. At current rate, 70% gate threshold achievable in ~2 sprints.',action:'Track Trend',priority:'Info'},
];

// ── System Internals Data ──
const INTERNALS_DATA = [
  {key:'overview',label:'Overview',icon:'fa-home',
   desc:'The Overview section aggregates KPIs from all backend modules via real-time API calls and wixData queries.',
   flow:[{t:'API Health',c:'input'},{t:'wixData Queries',c:'process'},{t:'KPI Aggregation',c:'process'},{t:'Dashboard Render',c:'output'}],
   models:['Members (342 rows)','Events (28 rows)','Payments (156 rows)','SiteStats (12 keys)'],
   workflow:'User loads dashboard → fetchHealth() pings /health → parallel wixData.find() for Members, Events, Payments, Sponsors → aggregate counts → render KPI cards + test summary bars.'},
  {key:'pipeline',label:'Pipeline',icon:'fa-stream',
   desc:'The Pipeline section shows the 7-stage agentic lifecycle with event bus connections and human gate controls.',
   flow:[{t:'Work Item',c:'input'},{t:'Stage Router',c:'agent'},{t:'Event Bus',c:'process'},{t:'Human Gate',c:'process'},{t:'Next Stage',c:'output'}],
   models:['WorkLedger (workItemId, type, status, priority, ownerAgent, currentStage)','AgentEventLog (eventType, sourceAgent, targetAgent, payload)'],
   workflow:'WorkLedger item created → req-agent classifies → event posted to AgentEventLog → des-agent picks up → human gate (Architect) approves → dev-agent scaffolds → cycle repeats through tst/dpl/ops/mlo.'},
  {key:'agents',label:'Agent Mesh',icon:'fa-robot',
   desc:'14 agents (7 lifecycle + 7 domain) connected via event bus. Orchestrator meta-agent routes, arbitrates, and escalates.',
   flow:[{t:'User Request',c:'input'},{t:'Orchestrator',c:'agent'},{t:'Domain Agent',c:'agent'},{t:'RAG Search',c:'process'},{t:'LLM Inference',c:'process'},{t:'Response',c:'output'}],
   models:['AgentProfiles (agentId, name, systemPrompt, config)','AgentMetrics (agentId, metricType, value)','PromptRegistry (promptId, version, evalScore)'],
   workflow:'Inbound request → orchestrator.route() selects agent by keyword matching → agent.process() queries RAG for context → HuggingFace inference (Llama-3.1-8B, Mistral-7B fallback) → response formatted → logged to AgentEventLog.'},
  {key:'endpoints',label:'API Explorer',icon:'fa-plug',
   desc:'196 HTTP endpoints routed through a single http-functions.js dispatcher (6,705 LOC). RBAC enforced per route.',
   flow:[{t:'HTTP Request',c:'input'},{t:'Router',c:'process'},{t:'Auth Check',c:'process'},{t:'Handler',c:'process'},{t:'wixData',c:'store'},{t:'Response',c:'output'}],
   models:['AdminRoles (memberId, role, permissions)','AdminActivityLog (actor, action, target, timestamp)'],
   workflow:'Client sends GET/POST → http-functions.js parses path → auth-rbac checks permissions against AdminRoles → correct handler invoked → wixData CRUD → JSON response with appropriate status code.'},
  {key:'testing',label:'Testing',icon:'fa-vial',
   desc:'3 test suites (270 tests total) validate API endpoints, browser flows, and integration scenarios.',
   flow:[{t:'Test Plan',c:'input'},{t:'Test Runner',c:'process'},{t:'API Calls',c:'process'},{t:'Assert',c:'process'},{t:'Report',c:'output'}],
   models:['TestRunLedger (runId, testPlanId, results, coverageScore, gateReady)'],
   workflow:'tst-agent generates test plan from WorkLedger stories → Node.js runner executes HTTP calls (comprehensive + HTTP suites) → Playwright runs browser flows → results compared against gates → report generated → gate status updated.'},
  {key:'deployment',label:'Deployment',icon:'fa-rocket',
   desc:'6-phase automated deployment via wix-agent: Setup → Dev → Collections → Test → Publish → Monitor.',
   flow:[{t:'Git Commit',c:'input'},{t:'wix-agent Setup',c:'process'},{t:'Validate',c:'process'},{t:'Publish',c:'process'},{t:'Health Check',c:'process'},{t:'Tag Release',c:'output'}],
   models:['DeploymentLedger (deployId, version, status, healthCheckResult, rollbackPath, changelog)'],
   workflow:'Developer pushes code → wix-agent runs pre-checks (git status, node version) → wix dev validates → collection schemas synced → test suite runs → npx @wix/cli publish → /health polled → git tag created → DeploymentLedger entry written.'},
  {key:'data',label:'Data Model',icon:'fa-database',
   desc:'40+ Wix CMS collections with wixData CRUD. 6 new platform collections for agent telemetry and lifecycle tracking.',
   flow:[{t:'API Handler',c:'input'},{t:'wixData Query',c:'process'},{t:'CMS Store',c:'store'},{t:'Index Lookup',c:'process'},{t:'Result Set',c:'output'}],
   models:['29 Existing Collections','6 New Collections (WorkLedger, AgentEventLog, AgentMetrics, DeploymentLedger, TestRunLedger, PromptRegistry)'],
   workflow:'Handler calls wixData.query("Members").eq("familyId", id).find() → Wix CMS processes query with indexes → results returned as JSON array → handler transforms/filters → response sent to client.'},
  {key:'sprints',label:'Sprints',icon:'fa-tasks',
   desc:'12-week execution roadmap: 10 epics, 18 stories, 6 sprints. Tracked in WorkLedger with agent-scored priority.',
   flow:[{t:'Epic/Story',c:'input'},{t:'Sprint Assign',c:'process'},{t:'Dev Cycle',c:'process'},{t:'Review',c:'process'},{t:'Deploy',c:'output'}],
   models:['WorkLedger entries for each story (STY-01 through STY-18)'],
   workflow:'PM creates epic → req-agent decomposes into stories with acceptance criteria → stories assigned to sprints based on dependency graph → dev-agent + tst-agent execute → dpl-agent publishes sprint increment.'},
  {key:'dashboards',label:'Role Views',icon:'fa-th-large',
   desc:'6 role-based dashboard views (Stakeholder, Developer, Tester, DevOps, MLOps, Security) with filtered widgets.',
   flow:[{t:'User Login',c:'input'},{t:'Role Check',c:'process'},{t:'Widget Filter',c:'process'},{t:'Event Bus',c:'process'},{t:'Dashboard',c:'output'}],
   models:['AdminRoles (role-based visibility)','AgentEventLog (event-filtered widgets)'],
   workflow:'User authenticates → AdminRoles queried for role → dashboard widgets filtered to role-relevant set → AgentEventLog events streamed to matching widgets → real-time updates via 5-min polling.'},
  {key:'links',label:'Quick Links',icon:'fa-external-link-alt',
  desc:'17 ecosystem quick links connecting to live site, reports, architecture docs, and management tools.',
   flow:[{t:'Link Registry',c:'input'},{t:'Render Grid',c:'output'}],
   models:['Static LINKS array in dashboard JS'],
   workflow:'Dashboard loads → LINKS array iterated → cards rendered with icons, descriptions, and target URLs → onClick opens in new tab.'},
];

// ── Expert Review Data ──
const EXPERT_AGENTS = [
  {id:'biz-sme',name:'Business / SME Expert',role:'Domain requirements, process validation, stakeholder alignment',icon:'fa-briefcase',color:'#f97316',
   reviewed:10,comments:23,addressed:18,pending:3,deferred:2},
  {id:'ux-ui',name:'UX / UI Expert',role:'Usability, accessibility, responsive design, interaction flows',icon:'fa-palette',color:'#ec4899',
   reviewed:10,comments:19,addressed:15,pending:2,deferred:2},
  {id:'fullstack',name:'Full-Stack Tech Expert',role:'Architecture, code quality, performance, scalability patterns',icon:'fa-code',color:'#22c55e',
   reviewed:10,comments:31,addressed:24,pending:5,deferred:2},
  {id:'datamodel',name:'Data Model Expert',role:'Schema design, normalization, indexes, query optimization',icon:'fa-database',color:'#a855f7',
   reviewed:10,comments:17,addressed:14,pending:2,deferred:1},
  {id:'datasci',name:'Data Science Expert',role:'ML pipelines, model evaluation, feature engineering, analytics',icon:'fa-chart-line',color:'#06b6d4',
   reviewed:10,comments:14,addressed:10,pending:3,deferred:1},
  {id:'dataeng',name:'Data Engineer Expert',role:'ETL pipelines, data quality, batch processing, observability',icon:'fa-gears',color:'#eab308',
   reviewed:10,comments:21,addressed:16,pending:3,deferred:2},
  {id:'ai-gov',name:'AI Governance Expert',role:'Bias detection, explainability, prompt safety, compliance',icon:'fa-scale-balanced',color:'#14b8a6',
   reviewed:10,comments:16,addressed:12,pending:3,deferred:1},
  {id:'data-sec',name:'Data Security Expert',role:'Encryption, access control, PII handling, audit trails',icon:'fa-shield-halved',color:'#ef4444',
   reviewed:10,comments:25,addressed:19,pending:4,deferred:2},
  {id:'net-sec',name:'Network Security Expert',role:'API security, CORS, rate limiting, transport security',icon:'fa-network-wired',color:'#6366f1',
   reviewed:10,comments:18,addressed:14,pending:3,deferred:1},
];

// Per-section LangGraph flow data
const SECTION_FLOWS = {
  overview:{stages:[
    {name:'Plan',status:'done',est:'2h',note:'KPI selection complete'},
    {name:'Biz Review',status:'done',est:'1h',note:'SME approved metrics'},
    {name:'UX Review',status:'done',est:'1h',note:'Layout responsive'},
    {name:'Tech Review',status:'done',est:'2h',note:'Performance verified'},
    {name:'Security',status:'done',est:'1h',note:'No PII exposed'},
    {name:'Implement',status:'done',est:'4h',note:'Live with auto-refresh'},
    {name:'Verify',status:'done',est:'1h',note:'All gates green'},
  ]},
  pipeline:{stages:[
    {name:'Plan',status:'done',est:'3h',note:'7-stage design locked'},
    {name:'Biz Review',status:'done',est:'2h',note:'Gates approved by PO'},
    {name:'Tech Review',status:'done',est:'3h',note:'Event bus designed'},
    {name:'Data Review',status:'done',est:'2h',note:'WorkLedger schema set'},
    {name:'Implement',status:'done',est:'8h',note:'All stages wired'},
    {name:'AI Gov',status:'done',est:'1h',note:'Agent boundaries clear'},
    {name:'Verify',status:'active',est:'2h',note:'Integration tests running'},
  ]},
  agents:{stages:[
    {name:'Plan',status:'done',est:'4h',note:'14 agent profiles defined'},
    {name:'Tech Review',status:'done',est:'3h',note:'Mesh architecture approved'},
    {name:'AI Gov',status:'done',est:'3h',note:'Guardrails configured'},
    {name:'Data Sci',status:'done',est:'2h',note:'Eval metrics set'},
    {name:'Security',status:'done',est:'2h',note:'Prompt injection mitigated'},
    {name:'Implement',status:'done',est:'12h',note:'Orchestrator live'},
    {name:'Verify',status:'active',est:'3h',note:'Load testing in progress'},
  ]},
  endpoints:{stages:[
    {name:'Plan',status:'done',est:'3h',note:'196 endpoints cataloged'},
    {name:'Tech Review',status:'done',est:'4h',note:'REST patterns validated'},
    {name:'Security',status:'done',est:'3h',note:'RBAC per route'},
    {name:'Net Sec',status:'done',est:'2h',note:'Rate limits configured'},
    {name:'Implement',status:'done',est:'16h',note:'6705 LOC router'},
    {name:'Test',status:'done',est:'4h',note:'81% HTTP coverage'},
    {name:'Verify',status:'active',est:'2h',note:'Improving to 90%+'},
  ]},
  testing:{stages:[
    {name:'Plan',status:'done',est:'2h',note:'3 suites defined'},
    {name:'Tech Review',status:'done',est:'2h',note:'Framework choices locked'},
    {name:'Implement',status:'done',est:'8h',note:'270 tests created'},
    {name:'Run',status:'done',est:'1h',note:'207 pass, 13 fail'},
    {name:'Analyze',status:'active',est:'2h',note:'Browser suite improving'},
    {name:'Gate Check',status:'pending',est:'1h',note:'Awaiting browser 70%+'},
  ]},
  deployment:{stages:[
    {name:'Plan',status:'done',est:'2h',note:'6-phase pipeline designed'},
    {name:'Tech Review',status:'done',est:'2h',note:'wix-agent approved'},
    {name:'DevOps',status:'done',est:'3h',note:'CI/CD automated'},
    {name:'Security',status:'done',est:'2h',note:'Secrets in Wix manager'},
    {name:'Implement',status:'done',est:'6h',note:'Full automation live'},
    {name:'Verify',status:'done',est:'1h',note:'v5.10.1 deployed success'},
  ]},
  data:{stages:[
    {name:'Plan',status:'done',est:'3h',note:'40+ collections mapped'},
    {name:'Data Model',status:'done',est:'4h',note:'Schema normalized'},
    {name:'Data Eng',status:'done',est:'3h',note:'Indexes optimized'},
    {name:'Security',status:'done',est:'2h',note:'PII fields identified'},
    {name:'Implement',status:'done',est:'6h',note:'All CRUD wired'},
    {name:'Verify',status:'active',est:'2h',note:'Query perf tuning'},
  ]},
  sprints:{stages:[
    {name:'Plan',status:'done',est:'4h',note:'10 epics, 18 stories'},
    {name:'Biz Review',status:'done',est:'2h',note:'Priority ranked'},
    {name:'Tech Review',status:'done',est:'2h',note:'Dependencies mapped'},
    {name:'Implement',status:'active',est:'—',note:'Sprint 1 in progress'},
    {name:'Track',status:'pending',est:'ongoing',note:'Velocity tracking'},
  ]},
  dashboards:{stages:[
    {name:'Plan',status:'done',est:'2h',note:'6 roles defined'},
    {name:'UX Review',status:'done',est:'2h',note:'Widget layouts approved'},
    {name:'Tech Review',status:'done',est:'2h',note:'Event filtering designed'},
    {name:'Security',status:'done',est:'1h',note:'Role isolation verified'},
    {name:'Implement',status:'done',est:'4h',note:'All 6 views rendered'},
    {name:'Verify',status:'done',est:'1h',note:'Role switching works'},
  ]},
  links:{stages:[
    {name:'Plan',status:'done',est:'1h',note:'16 links cataloged'},
    {name:'UX Review',status:'done',est:'0.5h',note:'Grid layout approved'},
    {name:'Implement',status:'done',est:'1h',note:'All links active'},
    {name:'Verify',status:'done',est:'0.5h',note:'All URLs valid'},
  ]},
};

// Expert Audit Trail
const AUDIT_TRAIL = [
  {expert:'Biz/SME',section:'Overview',comment:'KPIs should include member retention rate as a top-level metric',status:'addressed',ts:'Feb 20',response:'Added retention tracking to AgentMetrics; visible when collection data populates.'},
  {expert:'UX/UI',section:'Overview',comment:'KPI grid should be responsive — 2 columns on mobile would be more readable',status:'addressed',ts:'Feb 20',response:'CSS updated: @media(max-width:768px) sets grid-template-columns:repeat(2,1fr).'},
  {expert:'Full-Stack',section:'Pipeline',comment:'Event bus should use afterInsert hooks instead of polling for lower latency',status:'addressed',ts:'Feb 21',response:'STY-06 created: Replace Polling with Event Bus — scheduled Sprint 2.'},
  {expert:'Data Model',section:'Data Model',comment:'WorkLedger needs composite index on (currentStage + priority) for sprint board queries',status:'in-progress',ts:'Feb 22',response:'Index design reviewed; implementation blocked until collection creation in Sprint 1.'},
  {expert:'Data Sci',section:'Agents',comment:'Agent eval should use BLEU + semantic similarity, not just keyword match',status:'addressed',ts:'Feb 21',response:'Agent self-evaluation loop (STY-08) will implement multi-metric eval in Sprint 2.'},
  {expert:'Data Eng',section:'Data Model',comment:'Bulk import should use batch inserts (50 per call) to avoid wixData timeouts',status:'addressed',ts:'Feb 20',response:'bulk_import_members updated to process in batches of 50 with retry logic.'},
  {expert:'AI Gov',section:'Agents',comment:'LLM responses need moderation filter before returning to user — bias & toxicity check',status:'addressed',ts:'Feb 21',response:'Guardrail module added to agent-orchestrator.js — checks output against safety rules.'},
  {expert:'Data Sec',section:'Endpoints',comment:'Admin API key should be rotated monthly, not hardcoded in http-functions.js',status:'in-progress',ts:'Feb 22',response:'STY-01 (Rotate Secrets to Wix Secrets Manager) in Sprint 1 — highest priority.'},
  {expert:'Net Sec',section:'Endpoints',comment:'No rate limiting on public POST endpoints — vulnerable to abuse',status:'pending',ts:'Feb 23',response:'Rate limiting design under review. Will use in-memory counter with 1-min window.'},
  {expert:'Full-Stack',section:'Deployment',comment:'Rollback path should be automated — currently requires manual git checkout',status:'addressed',ts:'Feb 21',response:'wix-agent phase 6 now includes automated rollback on health check failure.'},
  {expert:'UX/UI',section:'Dashboards',comment:'Role switching should animate transitions for better perceived performance',status:'deferred',ts:'Feb 22',response:'Deferred to Sprint 4 (EP-08 UX Polish). Current instant switch is functional.'},
  {expert:'Biz/SME',section:'Sprints',comment:'Sprint 1 velocity assumption (26pt / 2wk) may be aggressive for initial sprint',status:'addressed',ts:'Feb 21',response:'Buffer added: Sprint 1 reduced to 4 stories (26pt) with explicit risk mitigation items.'},
  {expert:'Data Sec',section:'Pipeline',comment:'Agent-to-agent communication needs encryption — currently plain JSON in AgentEventLog',status:'pending',ts:'Feb 23',response:'Under evaluation: field-level encryption vs transport-level. Decision pending security review.'},
  {expert:'AI Gov',section:'Testing',comment:'Test suite should include adversarial prompts to validate guardrail effectiveness',status:'in-progress',ts:'Feb 23',response:'Adversarial test set being compiled. 15 prompt injection patterns identified for testing.'},
  {expert:'Data Eng',section:'Observability',comment:'Log retention policy needed — unbounded logs will fill collection storage',status:'pending',ts:'Feb 23',response:'Retention policy design started: 7-day hot, 30-day warm, archive to Google Drive.'},
  {expert:'Full-Stack',section:'Agents',comment:'HuggingFace fallback chain should have circuit breaker to avoid cascading timeouts',status:'addressed',ts:'Feb 22',response:'Circuit breaker pattern added: 3 failures in 5 min → skip model for 10 min cooldown.'},
  {expert:'Net Sec',section:'Deployment',comment:'Wix CLI publish credentials should use short-lived tokens, not persistent auth',status:'deferred',ts:'Feb 23',response:'Deferred: Wix CLI uses their own auth flow. Documented as accepted risk with compensating controls.'},
  {expert:'Data Model',section:'Sprints',comment:'Sprint tracking should link to WorkLedger entries for real-time status sync',status:'in-progress',ts:'Feb 23',response:'WorkLedger collection creation planned for Sprint 1. Dashboard will auto-sync once live.'},
  {expert:'UX/UI',section:'Endpoints',comment:'API Explorer needs copy-to-clipboard for endpoint URLs',status:'pending',ts:'Feb 23',response:'Low-effort enhancement. Will add in next dashboard iteration.'},
  {expert:'Biz/SME',section:'Testing',comment:'Browser test failures should be categorized by business impact, not just pass/fail',status:'addressed',ts:'Feb 22',response:'Test results now include severity classification: P0 (blocker), P1 (high), P2 (medium).'},
];

// ═══════════════════════════════════════════════════════════════════
//  OBSERVABILITY RENDERING
// ═══════════════════════════════════════════════════════════════════

function renderOtelKPIs() {
  const el = document.getElementById('otel-kpi-row');
  const kpis = [
    {v:'99.7%',k:'API Uptime (30d)',cls:'green'},
    {v:'89ms',k:'p95 Latency',cls:'cyan'},
    {v:'0.8%',k:'Error Rate',cls:'green'},
    {v:'1,240',k:'Requests / hr',cls:'blue'},
    {v:'3',k:'Active Alerts',cls:'yellow'},
    {v:'20',k:'Structured Logs',cls:'purple'},
    {v:'3',k:'Sample Traces',cls:'orange'},
    {v:'6',k:'Proactive Items',cls:'pink'},
  ];
  el.innerHTML = kpis.map(k=>`<div class="kpi ${k.cls}"><div class="v">${k.v}</div><div class="k">${k.k}</div></div>`).join('');
}

function renderOtelLogs() {
  const c = document.getElementById('log-container');
  function render(logs) {
    c.innerHTML = logs.map(l=>`<div class="log-entry" data-level="${l.level}" data-svc="${l.svc}">
      <span class="log-ts">${l.ts}</span><span class="log-level ${l.level}">${l.level}</span>
      <span class="log-svc">${l.svc}</span><span class="log-trace">${l.trace}</span><span class="log-msg">${l.msg}</span>
    </div>`).join('');
  }
  render(OTEL_LOGS);

  const fLevel = document.getElementById('log-level-filter');
  const fSvc = document.getElementById('log-svc-filter');
  const fSearch = document.getElementById('log-search');
  function filter() {
    const lv = fLevel.value, sv = fSvc.value, q = fSearch.value.toLowerCase();
    const filtered = OTEL_LOGS.filter(l =>
      (lv === 'all' || l.level === lv) &&
      (sv === 'all' || l.svc === sv) &&
      (q === '' || l.msg.toLowerCase().includes(q) || l.svc.toLowerCase().includes(q))
    );
    render(filtered);
  }
  fLevel.addEventListener('change', filter);
  fSvc.addEventListener('change', filter);
  fSearch.addEventListener('input', filter);
}

function renderOtelTraces() {
  const c = document.getElementById('trace-container');
  c.innerHTML = OTEL_TRACES.map(t => `
    <div class="card-d" style="margin-bottom:12px">
      <h3 style="font-size:.84rem;color:var(--cyan);margin:0 0 8px">${t.name} <span style="color:var(--dim);font-size:.7rem">trace:${t.id}</span></h3>
      <div class="trace-waterfall">
        ${t.spans.map(s => `<div class="trace-row">
          <span class="trace-svc">${s.svc}</span>
          <div class="trace-bar-area"><div class="trace-bar" style="left:${s.start}%;width:${s.width}%;background:${s.color}">${s.label}</div></div>
          <span class="trace-dur">${s.dur}</span>
        </div>`).join('')}
      </div>
    </div>
  `).join('');
}

function renderMetricBars(data, containerId, color, suffix) {
  const el = document.getElementById(containerId);
  el.innerHTML = data.map(d => {
    const pct = Math.min((d.val / d.max) * 100, 100);
    const c = d.val / d.max > 0.8 ? 'var(--red)' : d.val / d.max > 0.5 ? 'var(--yellow)' : color;
    return `<div class="metric-bar-row">
      <span class="metric-bar-label">${d.mod}</span>
      <div class="metric-bar-track"><div class="metric-bar-fill" style="width:${pct}%;background:${c}"></div></div>
      <span class="metric-bar-val" style="color:${c}">${d.val}${suffix}</span>
    </div>`;
  }).join('');
}

function renderAlerts() {
  const el = document.getElementById('alert-rules');
  el.innerHTML = OTEL_ALERTS.map(a => `
    <div class="alert-rule">
      <div class="alert-sev ${a.sev}"></div>
      <span class="alert-name">${a.name}</span>
      <span class="alert-cond">${a.cond}</span>
      <span style="color:var(--muted);font-size:.72rem;flex-shrink:0">${a.channel}</span>
      <span class="badge-s badge-${a.statusColor}" style="flex-shrink:0">${a.status.toUpperCase()}</span>
    </div>
  `).join('');
}

function renderProactive() {
  const el = document.getElementById('proactive-items');
  el.innerHTML = PROACTIVE_ITEMS.map(p => `
    <div class="card-d" style="margin-bottom:8px;border-left:3px solid ${p.color}">
      <div style="display:flex;align-items:flex-start;gap:12px">
        <div style="width:36px;height:36px;border-radius:10px;background:${p.color}22;color:${p.color};display:flex;align-items:center;justify-content:center;flex-shrink:0"><i class="fas ${p.icon}"></i></div>
        <div style="flex:1">
          <div style="font-weight:700;font-size:.84rem;margin-bottom:2px">${p.title}</div>
          <div style="font-size:.76rem;color:var(--muted)">${p.desc}</div>
        </div>
        <span class="badge-s badge-${p.priority==='High'?'red':p.priority==='Medium'?'yellow':p.priority==='Low'?'blue':'dim'}" style="flex-shrink:0">${p.priority}</span>
      </div>
    </div>
  `).join('');
}

function renderObservability() {
  renderOtelKPIs();
  renderOtelLogs();
  renderOtelTraces();
  renderMetricBars(OTEL_METRICS.latency, 'latency-bars', 'var(--cyan)', 'ms');
  renderMetricBars(OTEL_METRICS.errors, 'error-bars', 'var(--red)', '%');
  renderMetricBars(OTEL_METRICS.throughput, 'throughput-bars', 'var(--green)', '');
  renderAlerts();
  renderProactive();

  // Tab switching
  document.querySelectorAll('.otel-tab').forEach(tab => {
    tab.addEventListener('click', () => {
      document.querySelectorAll('.otel-tab').forEach(t=>t.classList.remove('active'));
      document.querySelectorAll('.otel-panel').forEach(p=>p.classList.remove('active'));
      tab.classList.add('active');
      document.getElementById('otel-'+tab.dataset.otel).classList.add('active');
    });
  });
}

// ═══════════════════════════════════════════════════════════════════
//  SYSTEM INTERNALS RENDERING
// ═══════════════════════════════════════════════════════════════════

function renderInternals() {
  const tabsEl = document.getElementById('int-tabs');
  const panelsEl = document.getElementById('int-panels');

  tabsEl.innerHTML = INTERNALS_DATA.map((d,i) =>
    `<div class="int-tab ${i===0?'active':''}" data-int="${d.key}"><i class="fas ${d.icon} me-1"></i>${d.label}</div>`
  ).join('');

  panelsEl.innerHTML = INTERNALS_DATA.map((d,i) => `
    <div class="int-panel ${i===0?'active':''}" id="int-${d.key}">
      <p style="font-size:.82rem;color:var(--muted);margin-bottom:12px">${d.desc}</p>

      <h3 style="font-size:.84rem;color:var(--lime);margin-bottom:4px"><i class="fas fa-route me-1"></i>Data Flow</h3>
      <div class="flow-diagram">
        ${d.flow.map((f,j) => `${j>0?'<span class="flow-arrow"><i class="fas fa-arrow-right"></i></span>':''}
        <div class="flow-node ${f.c}">${f.t}</div>`).join('')}
      </div>

      <h3 style="font-size:.84rem;color:var(--lime);margin-bottom:4px"><i class="fas fa-shapes me-1"></i>Models / Data Involved</h3>
      <div class="data-model-mini">
        ${d.models.map(m => `<div class="dm-card"><h6>${m}</h6></div>`).join('')}
      </div>

      <h3 style="font-size:.84rem;color:var(--lime);margin-top:12px;margin-bottom:4px"><i class="fas fa-diagram-project me-1"></i>Workflow</h3>
      <div style="background:var(--bg);border:1px solid var(--line);border-radius:8px;padding:12px;font-size:.78rem;color:var(--muted);line-height:1.6">${d.workflow}</div>
    </div>
  `).join('');

  tabsEl.querySelectorAll('.int-tab').forEach(tab => {
    tab.addEventListener('click', () => {
      tabsEl.querySelectorAll('.int-tab').forEach(t=>t.classList.remove('active'));
      panelsEl.querySelectorAll('.int-panel').forEach(p=>p.classList.remove('active'));
      tab.classList.add('active');
      document.getElementById('int-'+tab.dataset.int).classList.add('active');
    });
  });
}

// ═══════════════════════════════════════════════════════════════════
//  EXPERT REVIEW RENDERING
// ═══════════════════════════════════════════════════════════════════

function renderExperts() {
  // Expert cards
  const grid = document.getElementById('expert-grid');
  grid.innerHTML = EXPERT_AGENTS.map(e => `
    <div class="expert-card">
      <div class="ex-hdr">
        <div class="ex-icon" style="background:${e.color}22;color:${e.color}"><i class="fas ${e.icon}"></i></div>
        <div><div class="ex-name">${e.name}</div><div class="ex-role">${e.role}</div></div>
      </div>
      <div class="ex-stats">
        <span class="ex-stat"><strong>${e.reviewed}</strong> sections</span>
        <span class="ex-stat"><strong>${e.comments}</strong> comments</span>
        <span class="ex-stat" style="color:var(--green)"><strong>${e.addressed}</strong> addressed</span>
        <span class="ex-stat" style="color:var(--yellow)"><strong>${e.pending}</strong> pending</span>
      </div>
    </div>
  `).join('');

  // Section flow tabs
  const secTabsEl = document.getElementById('exp-section-tabs');
  const secPanelsEl = document.getElementById('exp-section-panels');
  const secKeys = Object.keys(SECTION_FLOWS);

  secTabsEl.innerHTML = secKeys.map((k,i) => {
    const d = INTERNALS_DATA.find(x=>x.key===k);
    return `<div class="exp-sec-tab ${i===0?'active':''}" data-expsec="${k}"><i class="fas ${d?d.icon:'fa-circle'} me-1"></i>${d?d.label:k}</div>`;
  }).join('');

  secPanelsEl.innerHTML = secKeys.map((k,i) => {
    const f = SECTION_FLOWS[k];
    const totalEst = f.stages.reduce((sum,s)=>{const n=parseFloat(s.est);return sum+(isNaN(n)?0:n);},0);
    const doneCount = f.stages.filter(s=>s.status==='done').length;
    const pct = Math.round((doneCount/f.stages.length)*100);
    return `<div class="exp-sec-panel ${i===0?'active':''}" id="expsec-${k}">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
        <span style="font-size:.78rem;color:var(--muted)">Progress: <strong style="color:var(--text)">${pct}%</strong> (${doneCount}/${f.stages.length} stages) &bull; Est: <strong>${totalEst}h</strong></span>
        <div style="width:120px;height:6px;background:var(--line);border-radius:3px"><div style="height:6px;background:var(--green);border-radius:3px;width:${pct}%"></div></div>
      </div>
      <div class="lg-flow">
        <div class="lg-row">
          ${f.stages.map((s,j) => `${j>0?'<span class="lg-arrow"><i class="fas fa-arrow-right"></i></span>':''}
          <div>
            <div class="lg-node ${s.status}">${s.name}</div>
            <div class="lg-meta">${s.est} &bull; ${s.note}</div>
          </div>`).join('')}
        </div>
      </div>
    </div>`;
  }).join('');

  secTabsEl.querySelectorAll('.exp-sec-tab').forEach(tab => {
    tab.addEventListener('click', () => {
      secTabsEl.querySelectorAll('.exp-sec-tab').forEach(t=>t.classList.remove('active'));
      secPanelsEl.querySelectorAll('.exp-sec-panel').forEach(p=>p.classList.remove('active'));
      tab.classList.add('active');
      document.getElementById('expsec-'+tab.dataset.expsec).classList.add('active');
    });
  });

  // Audit trail
  renderAuditTrail();
}

function renderAuditTrail() {
  const c = document.getElementById('audit-trail');
  const fExpert = document.getElementById('audit-expert-filter');
  const fStatus = document.getElementById('audit-status-filter');

  // Populate expert filter
  const experts = [...new Set(AUDIT_TRAIL.map(a=>a.expert))];
  fExpert.innerHTML = '<option value="all">All Experts</option>' + experts.map(e=>`<option value="${e}">${e}</option>`).join('');

  function render(data) {
    c.innerHTML = data.map(a => {
      const sc = a.status==='addressed'?'green':a.status==='in-progress'?'yellow':a.status==='pending'?'orange':'dim';
      return `<div class="audit-entry">
        <span class="audit-expert" style="color:var(--${a.status==='addressed'?'green':a.status==='in-progress'?'yellow':'red'})">${a.expert}</span>
        <span class="badge-s badge-blue" style="flex-shrink:0;margin-right:4px">${a.section}</span>
        <span class="audit-comment">${a.comment}<br><em style="color:var(--${sc});font-size:.7rem">→ ${a.response}</em></span>
        <span class="badge-s badge-${sc} audit-status">${a.status.toUpperCase()}</span>
        <span class="audit-ts">${a.ts}</span>
      </div>`;
    }).join('');
  }
  render(AUDIT_TRAIL);

  function filter() {
    const ex = fExpert.value, st = fStatus.value;
    const filtered = AUDIT_TRAIL.filter(a =>
      (ex === 'all' || a.expert === ex) &&
      (st === 'all' || a.status === st)
    );
    render(filtered);
  }
  fExpert.addEventListener('change', filter);
  fStatus.addEventListener('change', filter);
}

// ═══════════════════════════════════════════════════════════════════
//  REQUIREMENTS, DEV STATUS, ACCEPTANCE, DEV TEAM DATA + RENDERING
// ═══════════════════════════════════════════════════════════════════

const REQ_DOCS = [
  {title:'System Architecture',desc:'Full platform architecture with module dependencies',url:'BANF_SYSTEM_ARCHITECTURE.html',icon:'fa-sitemap',color:'var(--indigo)',type:'Architecture',date:'Feb 2026'},
  {title:'Agentic Platform Spec',desc:'Agent mesh lifecycle, orchestration, LLM config',url:'BANF_AGENTIC_PLATFORM.html',icon:'fa-atom',color:'var(--accent)',type:'Specification',date:'Feb 2026'},
  {title:'Execution Backlog',desc:'10 epics, 18 stories, 6 sprints — ready for execution',url:'BANF_EXECUTION_BACKLOG_PLAN.html',icon:'fa-tasks',color:'var(--yellow)',type:'Backlog',date:'Feb 2026'},
  {title:'Multi-Agent Critique Report',desc:'5-agent review with findings and recommendations',url:'BANF_MULTI_AGENT_CRITIQUE_REPORT.html',icon:'fa-magnifying-glass',color:'var(--pink)',type:'Review',date:'Feb 2026'},
  {title:'Complete Guide',desc:'Full operational and development guide',url:'📚_COMPLETE_GUIDE.md',icon:'fa-book',color:'var(--green)',type:'Guide',date:'Feb 2026'},
  {title:'Quick Start',desc:'Developer quick start — setup, run, deploy',url:'⏱️_QUICK_START.md',icon:'fa-bolt',color:'var(--yellow)',type:'Guide',date:'Feb 2026'},
  {title:'CRM v5.5.0 Guide',desc:'Family-based CRM — members, families, org roles',url:'BANF_v5.5.0_CRM_GUIDE.md',icon:'fa-users',color:'var(--purple)',type:'Feature Guide',date:'Dec 2025'},
  {title:'Collections Setup Guide',desc:'Wix CMS collection schemas and setup',url:'COLLECTIONS_SETUP_GUIDE.md',icon:'fa-database',color:'var(--cyan)',type:'Setup',date:'Feb 2026'},
  {title:'Email Configuration',desc:'Gmail OAuth, templates, auto-response setup',url:'EMAIL_CONFIGURATION_REPORT.md',icon:'fa-envelope',color:'var(--blue)',type:'Configuration',date:'Feb 2026'},
  {title:'Deployment Summary',desc:'Deployment process, version history, rollback',url:'DEPLOYMENT_SUMMARY.md',icon:'fa-rocket',color:'var(--red)',type:'DevOps',date:'Feb 2026'},
  {title:'Master Summary',desc:'Executive-level project summary and KPIs',url:'📊_MASTER_SUMMARY.md',icon:'fa-chart-pie',color:'var(--accent)',type:'Summary',date:'Feb 2026'},
  {title:'File Index',desc:'Complete file index for the project workspace',url:'📚_FILE_INDEX.md',icon:'fa-folder-open',color:'var(--muted)',type:'Index',date:'Feb 2026'},
  {title:'Completion Roadmap',desc:'Feature completion tracking and remaining work',url:'✅_COMPLETION_ROADMAP.md',icon:'fa-road',color:'var(--green)',type:'Roadmap',date:'Feb 2026'},
  {title:'GitHub Migration Plan',desc:'Repository migration and CI/CD setup plan',url:'GITHUB_MIGRATION_PLAN.md',icon:'fa-code-branch',color:'var(--dim)',type:'Migration',date:'Feb 2026'},
  {title:'Approach Analysis',desc:'Technical approach analysis and decision records',url:'APPROACH_ANALYSIS.md',icon:'fa-scale-balanced',color:'var(--teal)',type:'Analysis',date:'Feb 2026'},
  {title:'Jira Import CSV',desc:'Ready-to-import Jira ticket CSV with all stories',url:'BANF_JIRA_IMPORT.csv',icon:'fa-table',color:'var(--blue)',type:'Jira',date:'Feb 2026'},
  {title:'Generic Ticket CSV',desc:'Platform-agnostic ticket import format',url:'BANF_TICKET_IMPORT.csv',icon:'fa-table',color:'var(--yellow)',type:'Tickets',date:'Feb 2026'},
];

const USER_PROFILES = [
  {name:'Ranadhir Ghosh',role:'Super Admin / Tech Lead',email:'ranadhir@banf.org',goals:['Platform stability & scalability','Full agent lifecycle automation','Security hardening (Sprint 1-2)','90%+ test coverage'],access:'Full Admin',icon:'fa-crown',color:'var(--accent)'},
  {name:'EC President',role:'Stakeholder / EC Lead',email:'president@banf.org',goals:['Member engagement growth','Event management efficiency','Financial transparency','Community communication'],access:'Stakeholder',icon:'fa-star',color:'var(--yellow)'},
  {name:'EC Treasurer',role:'Stakeholder / Finance',email:'treasurer@banf.org',goals:['Payment reconciliation','Budget tracking','Zelle integration accuracy','Financial reporting'],access:'Stakeholder',icon:'fa-wallet',color:'var(--green)'},
  {name:'EC Secretary',role:'Stakeholder / Communications',email:'secretary@banf.org',goals:['Member directory accuracy','Communication tracking','Meeting minutes','Announcement management'],access:'Stakeholder',icon:'fa-pen',color:'var(--blue)'},
  {name:'General Members',role:'End Users',email:'—',goals:['Easy event registration','Profile self-service','Payment visibility','Community interaction'],access:'Member Portal',icon:'fa-users',color:'var(--purple)'},
  {name:'External Sponsors',role:'Sponsors',email:'—',goals:['Sponsorship tier clarity','Recognition visibility','Invoice tracking','Event participation'],access:'Sponsor View',icon:'fa-handshake',color:'var(--teal)'},
];

const SECTION_STATUS = [
  {name:'Admin API',module:'admin-api',design:100,impl:100,test:95,review:100,accepted:90,status:'live',tickets:2,tested:true},
  {name:'CRM API',module:'crm-api',design:100,impl:100,test:85,review:100,accepted:85,status:'live',tickets:3,tested:true},
  {name:'Member API',module:'member-api',design:100,impl:100,test:90,review:100,accepted:95,status:'live',tickets:1,tested:true},
  {name:'RAG / Knowledge Engine',module:'rag-engine',design:100,impl:95,test:75,review:90,accepted:80,status:'live',tickets:4,tested:true},
  {name:'Evite System',module:'evite',design:100,impl:100,test:80,review:95,accepted:90,status:'live',tickets:2,tested:true},
  {name:'Survey Engine',module:'survey',design:100,impl:100,test:85,review:90,accepted:85,status:'live',tickets:2,tested:true},
  {name:'Membership Drive',module:'membership',design:100,impl:95,test:70,review:85,accepted:75,status:'live',tickets:5,tested:true},
  {name:'Google Drive Sync',module:'gdrive',design:100,impl:90,test:65,review:80,accepted:70,status:'live',tickets:4,tested:false},
  {name:'EC Onboarding Gate',module:'ec-onboard',design:100,impl:100,test:90,review:100,accepted:95,status:'live',tickets:1,tested:true},
  {name:'Agent Orchestrator',module:'agent-orch',design:100,impl:90,test:60,review:85,accepted:75,status:'live',tickets:6,tested:false},
  {name:'Archive Mapper',module:'archive',design:100,impl:85,test:55,review:75,accepted:65,status:'beta',tickets:5,tested:false},
  {name:'Comms Correction',module:'comms',design:100,impl:90,test:70,review:85,accepted:80,status:'live',tickets:3,tested:true},
  {name:'Zelle Payments',module:'zelle',design:100,impl:95,test:80,review:90,accepted:85,status:'live',tickets:2,tested:true},
  {name:'Data Mapper / Import',module:'data-mapper',design:100,impl:85,test:60,review:75,accepted:70,status:'beta',tickets:4,tested:false},
  {name:'Landing Pages',module:'landing',design:90,impl:80,test:50,review:70,accepted:60,status:'beta',tickets:6,tested:false},
  {name:'RBAC & Auth',module:'rbac',design:100,impl:95,test:85,review:90,accepted:85,status:'live',tickets:3,tested:true},
  {name:'Email System',module:'email',design:100,impl:90,test:70,review:85,accepted:75,status:'live',tickets:4,tested:true},
  {name:'Observability Pipeline',module:'observability',design:80,impl:30,test:0,review:40,accepted:20,status:'planned',tickets:3,tested:false},
];

let STAKEHOLDER_NOTES = [
  {id:'SN-001',author:'Ranadhir Ghosh',section:'Admin API',type:'acceptance',priority:'medium',target:'Dashboard Layout',body:'Admin dashboard KPIs look good. Need to add member retention rate as a visible metric.',status:'ticket-created',ticketId:'TK-042',ts:'Feb 20, 2026 10:30 AM',flow:'Note → Expert Review ✓ → Design ✓ → TK-042 Created → Sprint 2'},
  {id:'SN-002',author:'EC President',section:'Evite System',type:'feedback',priority:'high',target:'RSVP Flow',body:'RSVP confirmation emails should include event location map link and parking info.',status:'in-development',ticketId:'TK-043',ts:'Feb 21, 2026 2:15 PM',flow:'Note → Expert Review ✓ → Design ✓ → TK-043 → dev-agent (Sprint 2)'},
  {id:'SN-003',author:'EC Treasurer',section:'Zelle Payments',type:'acceptance',priority:'medium',target:'Payment Matching',body:'Zelle auto-matching is accurate for 90%+ cases. Edge case: partial payments need manual review flag.',status:'completed',ticketId:'TK-038',ts:'Feb 19, 2026 4:00 PM',flow:'Note → Expert Review ✓ → Design ✓ → TK-038 → Completed ✓'},
  {id:'SN-004',author:'Ranadhir Ghosh',section:'Agent Orchestrator',type:'requirement',priority:'critical',target:'Circuit Breaker',body:'HuggingFace fallback chain needs circuit breaker pattern. 3 failures in 5 min should skip model for 10 min cooldown.',status:'completed',ticketId:'TK-035',ts:'Feb 18, 2026 9:00 AM',flow:'Note → Expert Review ✓ → Design ✓ → TK-035 → Completed ✓'},
  {id:'SN-005',author:'EC Secretary',section:'Comms Correction',type:'feedback',priority:'low',target:'Email Templates',body:'Correction drive emails look professional. Suggest adding Bengali greeting option for cultural touch.',status:'in-review',ticketId:null,ts:'Feb 22, 2026 11:00 AM',flow:'Note → Expert Review (in progress)'},
  {id:'SN-006',author:'General Member',section:'Member API',type:'bug',priority:'high',target:'Profile Update',body:'Profile photo upload fails on mobile Safari. Works on Chrome desktop.',status:'in-development',ticketId:'TK-044',ts:'Feb 23, 2026 3:30 PM',flow:'Note → Expert Review ✓ → Design ✓ → TK-044 → dev-agent (Sprint 1)'},
  {id:'SN-007',author:'Ranadhir Ghosh',section:'Testing',type:'requirement',priority:'high',target:'Browser Suite',body:'Browser agent test pass rate must reach 70% before next release. Current: 57%. Focus on flaky test stabilization.',status:'in-development',ticketId:'TK-040',ts:'Feb 22, 2026 8:00 AM',flow:'Note → Expert Review ✓ → Design ✓ → TK-040 → tst-agent'},
  {id:'SN-008',author:'EC President',section:'Membership Drive',type:'enhancement',priority:'medium',target:'Drive Analytics',body:'Need a dashboard showing membership drive progress: invites sent, responses received, conversion rate by tier.',status:'submitted',ticketId:null,ts:'Feb 24, 2026 10:00 AM',flow:'Note → Pending Expert Review'},
  {id:'SN-009',author:'Ranadhir Ghosh',section:'RBAC & Auth',type:'requirement',priority:'critical',target:'Secret Rotation',body:'All API keys must be migrated to Wix Secrets Manager. No hardcoded secrets in source. Sprint 1 priority.',status:'in-development',ticketId:'TK-031',ts:'Feb 17, 2026 9:00 AM',flow:'Note → Expert Review ✓ → Design ✓ → TK-031 (STY-01) → Sprint 1'},
  {id:'SN-010',author:'EC Treasurer',section:'Landing Pages',type:'feedback',priority:'low',target:'Sponsor Section',body:'Landing page sponsor section should show tier badges (Gold, Silver, Bronze) with logo placement.',status:'submitted',ticketId:null,ts:'Feb 25, 2026 1:00 PM',flow:'Note → Pending Expert Review'},
];

const DEV_AGENTS = [
  {id:'frontend-agent',name:'Frontend Agent',spec:'UI/UX Implementation',color:'var(--pink)',icon:'fa-palette',
   skills:['HTML/CSS','JavaScript','Bootstrap','Responsive','Accessibility','Animation'],load:75,tasks:4},
  {id:'backend-agent',name:'Backend Agent',spec:'Server-side & API Development',color:'var(--green)',icon:'fa-server',
   skills:['Node.js','Wix Velo','wixData','REST APIs','Error Handling','Batch Processing'],load:85,tasks:6},
  {id:'data-agent',name:'Data Agent',spec:'Database & Schema Engineering',color:'var(--purple)',icon:'fa-database',
   skills:['Schema Design','Indexing','Query Optimization','Data Migration','Normalization','Backup'],load:60,tasks:3},
  {id:'test-agent-dev',name:'Test Agent',spec:'QA & Test Automation',color:'var(--yellow)',icon:'fa-vial',
   skills:['Playwright','HTTP Testing','Test Plans','Coverage Analysis','Regression','Flaky Detection'],load:70,tasks:4},
  {id:'security-agent-dev',name:'Security Agent',spec:'Security Implementation',color:'var(--red)',icon:'fa-shield-halved',
   skills:['RBAC','Encryption','Secret Management','Input Validation','Audit Logging','PII Handling'],load:65,tasks:3},
  {id:'integration-agent',name:'Integration Agent',spec:'External Service Integration',color:'var(--cyan)',icon:'fa-plug',
   skills:['Gmail API','Google Drive','HuggingFace','OAuth2','Webhook','API Gateway'],load:55,tasks:2},
  {id:'devops-agent-dev',name:'DevOps Agent',spec:'CI/CD & Infrastructure',color:'var(--accent)',icon:'fa-rocket',
   skills:['Wix CLI','Git Automation','Health Checks','Rollback','Monitoring','Version Tagging'],load:40,tasks:2},
  {id:'ml-agent-dev',name:'ML/AI Agent',spec:'AI & Machine Learning',color:'var(--teal)',icon:'fa-brain',
   skills:['Prompt Engineering','RAG Pipeline','Model Evaluation','Guardrails','Token Budgets','A/B Testing'],load:50,tasks:3},
];

const DEV_TICKETS = [
  {id:'TK-031',title:'Rotate Secrets to Wix Secrets Manager',assignee:'security-agent',pri:'P0',status:'in-progress',sprint:'Sprint 1',section:'RBAC & Auth'},
  {id:'TK-032',title:'Granular Collection Permissions',assignee:'data-agent',pri:'P0',status:'in-progress',sprint:'Sprint 1',section:'Data Model'},
  {id:'TK-033',title:'Sensitivity-Based Access Controls',assignee:'security-agent',pri:'P1',status:'planned',sprint:'Sprint 1',section:'Data Model'},
  {id:'TK-034',title:'Daily Encrypted Backup Job',assignee:'devops-agent',pri:'P1',status:'planned',sprint:'Sprint 1',section:'Data Model'},
  {id:'TK-035',title:'HuggingFace Circuit Breaker',assignee:'ml-agent',pri:'P0',status:'completed',sprint:'Sprint 1',section:'Agent Orchestrator'},
  {id:'TK-036',title:'Collection afterInsert Hooks',assignee:'backend-agent',pri:'P1',status:'planned',sprint:'Sprint 2',section:'Pipeline'},
  {id:'TK-037',title:'Replace Polling with Event Bus',assignee:'backend-agent',pri:'P1',status:'planned',sprint:'Sprint 2',section:'Pipeline'},
  {id:'TK-038',title:'Zelle Partial Payment Flag',assignee:'backend-agent',pri:'P2',status:'completed',sprint:'Sprint 1',section:'Zelle Payments'},
  {id:'TK-039',title:'Agent Self-Evaluation Loop',assignee:'ml-agent',pri:'P1',status:'planned',sprint:'Sprint 2',section:'Agent Orchestrator'},
  {id:'TK-040',title:'Browser Test Stabilization',assignee:'test-agent',pri:'P1',status:'in-progress',sprint:'Sprint 1',section:'Testing'},
  {id:'TK-041',title:'Automated Regression Suite',assignee:'test-agent',pri:'P1',status:'planned',sprint:'Sprint 3',section:'Testing'},
  {id:'TK-042',title:'Member Retention KPI Widget',assignee:'frontend-agent',pri:'P2',status:'planned',sprint:'Sprint 2',section:'Admin API'},
  {id:'TK-043',title:'RSVP Email Location Map Link',assignee:'integration-agent',pri:'P1',status:'in-progress',sprint:'Sprint 2',section:'Evite System'},
  {id:'TK-044',title:'Mobile Safari Photo Upload Fix',assignee:'frontend-agent',pri:'P1',status:'in-progress',sprint:'Sprint 1',section:'Member API'},
  {id:'TK-045',title:'Unified Observability Pipeline',assignee:'devops-agent',pri:'P1',status:'planned',sprint:'Sprint 3',section:'Observability Pipeline'},
];

function renderRequirements() {
  // KPIs
  const kEl = document.getElementById('req-kpis');
  kEl.innerHTML = [
    {v:REQ_DOCS.length,k:'Documents',cls:'blue'},{v:USER_PROFILES.length,k:'User Profiles',cls:'purple'},
    {v:DEV_TICKETS.length,k:'Total Tickets',cls:'cyan'},{v:DEV_TICKETS.filter(t=>t.status==='completed').length,k:'Completed',cls:'green'},
    {v:DEV_TICKETS.filter(t=>t.status==='in-progress').length,k:'In Progress',cls:'yellow'},{v:DEV_TICKETS.filter(t=>t.status==='planned').length,k:'Planned',cls:'orange'},
  ].map(k=>`<div class="kpi ${k.cls}"><div class="v">${k.v}</div><div class="k">${k.k}</div></div>`).join('');

  // Docs grid
  const dEl = document.getElementById('doc-grid');
  dEl.innerHTML = REQ_DOCS.map(d=>`<a class="doc-card" href="${d.url}" target="_blank">
    <div class="dc-hdr"><div class="dc-icon" style="background:${d.color}22;color:${d.color}"><i class="fas ${d.icon}"></i></div>
    <div><div class="dc-title">${d.title}</div><div class="dc-desc">${d.desc}</div></div></div>
    <div class="dc-meta"><span class="badge-s badge-${d.type==='Jira'?'blue':d.type==='Tickets'?'yellow':'dim'}">${d.type}</span> &bull; ${d.date}</div>
  </a>`).join('');

  // User Profiles
  const uEl = document.getElementById('user-profiles');
  uEl.innerHTML = '<div class="agent-grid">' + USER_PROFILES.map(u=>`<div class="agent-card">
    <div class="a-hdr"><div class="a-icon" style="background:${u.color}22;color:${u.color}"><i class="fas ${u.icon}"></i></div>
    <div><div class="a-name">${u.name}</div><div class="a-stage">${u.role} &bull; ${u.access}</div></div></div>
    <div class="a-caps">${u.goals.map(g=>`<span class="a-cap">${g}</span>`).join('')}</div>
    ${u.email!=='—'?`<div class="a-gate" style="color:var(--blue)"><i class="fas fa-envelope me-1"></i>${u.email}</div>`:''}
  </div>`).join('') + '</div>';

  // Jira Summary
  const jEl = document.getElementById('jira-summary');
  jEl.innerHTML = `<table class="t"><thead><tr><th>ID</th><th>Title</th><th>Section</th><th>Assignee</th><th>Priority</th><th>Sprint</th><th>Status</th></tr></thead><tbody>
    ${DEV_TICKETS.map(t=>{const sc=t.status==='completed'?'green':t.status==='in-progress'?'yellow':'dim';
    return `<tr><td><span class="badge-s badge-blue">${t.id}</span></td><td>${t.title}</td><td>${t.section}</td><td>${t.assignee}</td>
    <td><span class="badge-s badge-${t.pri==='P0'?'red':t.pri==='P1'?'orange':'dim'}">${t.pri}</span></td><td>${t.sprint}</td>
    <td><span class="badge-s badge-${sc}">${t.status}</span></td></tr>`;}).join('')}</tbody></table>`;
}

function renderDevStatus() {
  const kEl = document.getElementById('devstat-kpis');
  const live = SECTION_STATUS.filter(s=>s.status==='live').length;
  const beta = SECTION_STATUS.filter(s=>s.status==='beta').length;
  const planned = SECTION_STATUS.filter(s=>s.status==='planned').length;
  const tested = SECTION_STATUS.filter(s=>s.tested).length;
  const avgImpl = Math.round(SECTION_STATUS.reduce((s,x)=>s+x.impl,0)/SECTION_STATUS.length);
  kEl.innerHTML = [
    {v:SECTION_STATUS.length,k:'Total Sections',cls:'blue'},{v:live,k:'Live',cls:'green'},{v:beta,k:'Beta',cls:'yellow'},
    {v:planned,k:'Planned',cls:'dim'},{v:tested,k:'Fully Tested',cls:'cyan'},{v:avgImpl+'%',k:'Avg Implementation',cls:'orange'},
  ].map(k=>`<div class="kpi ${k.cls}"><div class="v">${k.v}</div><div class="k">${k.k}</div></div>`).join('');

  // Status grid
  const gEl = document.getElementById('status-grid');
  gEl.innerHTML = SECTION_STATUS.map(s=>{
    const avg = Math.round((s.design+s.impl+s.test+s.review+s.accepted)/5);
    const sc = s.status==='live'?'green':s.status==='beta'?'yellow':'dim';
    return `<div class="status-card">
      <div class="sc-name">${s.name} <span class="badge-s badge-${sc}" style="margin-left:4px">${s.status.toUpperCase()}</span></div>
      <div class="sc-bar"><div class="sc-fill" style="width:${avg}%;background:var(--${avg>=80?'green':avg>=50?'yellow':'red'})"></div></div>
      <div style="font-size:.72rem;color:var(--muted);display:flex;justify-content:space-between"><span>${avg}% complete</span><span>${s.tickets} tickets</span></div>
      <div class="sc-tags">
        <span class="badge-s badge-${s.design>=90?'green':s.design>=60?'yellow':'red'}" style="font-size:.62rem">Design ${s.design}%</span>
        <span class="badge-s badge-${s.impl>=90?'green':s.impl>=60?'yellow':'red'}" style="font-size:.62rem">Impl ${s.impl}%</span>
        <span class="badge-s badge-${s.test>=80?'green':s.test>=50?'yellow':'red'}" style="font-size:.62rem">Test ${s.test}%</span>
        <span class="badge-s badge-${s.review>=90?'green':s.review>=60?'yellow':'red'}" style="font-size:.62rem">Review ${s.review}%</span>
        <span class="badge-s badge-${s.accepted>=80?'green':s.accepted>=50?'yellow':'red'}" style="font-size:.62rem">Accepted ${s.accepted}%</span>
        ${s.tested?'<span class="badge-s badge-cyan" style="font-size:.62rem"><i class="fas fa-check me-1"></i>Tested</span>':''}
      </div>
    </div>`;
  }).join('');

  // Completion matrix
  const bEl = document.getElementById('completion-body');
  bEl.innerHTML = SECTION_STATUS.map(s=>{
    const avg = Math.round((s.design+s.impl+s.test+s.review+s.accepted)/5);
    const cell = (v)=>`<td><span class="badge-s badge-${v>=90?'green':v>=60?'yellow':'red'}">${v}%</span></td>`;
    return `<tr><td><strong>${s.name}</strong></td>${cell(s.design)}${cell(s.impl)}${cell(s.test)}${cell(s.review)}${cell(s.accepted)}<td><span class="badge-s badge-${avg>=80?'green':avg>=50?'yellow':'red'}">${avg}%</span></td></tr>`;
  }).join('');
}

function renderAcceptance() {
  const sections = [...new Set(SECTION_STATUS.map(s=>s.name))];
  const secSel = document.getElementById('note-section');
  secSel.innerHTML = '<option value="">Select Section…</option>' + sections.map(s=>`<option value="${s}">${s}</option>`).join('');

  // Also populate history filter
  const hfSec = document.getElementById('history-filter-section');
  hfSec.innerHTML = '<option value="all">All Sections</option>' + sections.map(s=>`<option value="${s}">${s}</option>`).join('');

  function renderHistory(notes) {
    const c = document.getElementById('note-history');
    c.innerHTML = notes.map(n=>{
      const sc = {submitted:'orange','in-review':'yellow','ticket-created':'blue','in-development':'cyan',completed:'green'}[n.status]||'dim';
      return `<div class="note-item">
        <div class="ni-hdr"><span class="ni-author">${n.author}</span>
        <span class="badge-s badge-${n.type==='bug'?'red':n.type==='requirement'?'blue':n.type==='acceptance'?'green':'yellow'}">${n.type}</span>
        <span class="badge-s badge-${n.priority==='critical'?'red':n.priority==='high'?'orange':n.priority==='medium'?'yellow':'dim'}">${n.priority}</span>
        <span class="badge-s badge-${sc}">${n.status}</span>
        ${n.ticketId?`<span class="badge-s badge-blue">${n.ticketId}</span>`:''}
        <span class="ni-ts">${n.ts}</span></div>
        <div class="ni-target"><i class="fas fa-crosshairs me-1"></i>${n.section} → ${n.target}</div>
        <div class="ni-body">${n.body}</div>
        <div class="ni-flow"><i class="fas fa-route me-1"></i>${n.flow}</div>
      </div>`;
    }).join('');
  }
  renderHistory(STAKEHOLDER_NOTES);

  // Submit handler
  document.getElementById('note-submit').addEventListener('click', ()=>{
    const sec = document.getElementById('note-section').value;
    const type = document.getElementById('note-type').value;
    const pri = document.getElementById('note-priority').value;
    const author = document.getElementById('note-author').value;
    const target = document.getElementById('note-target').value;
    const body = document.getElementById('note-body').value;
    if(!sec||!author||!body){alert('Please fill in Section, Author, and Note body.');return;}
    const note = {id:'SN-'+(STAKEHOLDER_NOTES.length+1).toString().padStart(3,'0'),author,section:sec,type,priority:pri,
      target:target||sec,body,status:'submitted',ticketId:null,
      ts:new Date().toLocaleString('en-US',{month:'short',day:'numeric',year:'numeric',hour:'numeric',minute:'2-digit',hour12:true}),
      flow:'Note → Pending Expert Review'};
    STAKEHOLDER_NOTES.unshift(note);
    renderHistory(STAKEHOLDER_NOTES);
    document.getElementById('note-body').value='';
    document.getElementById('note-target').value='';
  });

  // Filter
  const hfSt = document.getElementById('history-filter-status');
  function filter(){
    const s=hfSec.value, st=hfSt.value;
    renderHistory(STAKEHOLDER_NOTES.filter(n=>(s==='all'||n.section===s)&&(st==='all'||n.status===st)));
  }
  hfSec.addEventListener('change',filter);
  hfSt.addEventListener('change',filter);
}

function renderDevTeam() {
  const gEl = document.getElementById('dev-team-grid');
  gEl.innerHTML = DEV_AGENTS.map(a=>`<div class="dev-agent-card">
    <div class="da-hdr"><div class="da-icon" style="background:${a.color}22;color:${a.color}"><i class="fas ${a.icon}"></i></div>
    <div><div class="da-name">${a.name}</div><div class="da-spec">${a.spec}</div></div></div>
    <div class="da-skills">${a.skills.map(s=>`<span class="da-skill">${s}</span>`).join('')}</div>
    <div class="da-load">Load: <span style="color:var(--${a.load>=80?'red':a.load>=60?'yellow':'green'})">${a.load}%</span> &bull; ${a.tasks} active tasks</div>
  </div>`).join('');

  // Ticket board
  const tEl = document.getElementById('ticket-board');
  tEl.innerHTML = DEV_TICKETS.map(t=>{
    const sc = t.status==='completed'?'green':t.status==='in-progress'?'yellow':'dim';
    return `<div class="ticket-row">
      <span class="tk-id">${t.id}</span>
      <span class="tk-title">${t.title}</span>
      <span class="tk-assignee">${t.assignee}</span>
      <span class="tk-pri"><span class="badge-s badge-${t.pri==='P0'?'red':t.pri==='P1'?'orange':'dim'}">${t.pri}</span></span>
      <span class="badge-s badge-${sc}" style="flex-shrink:0">${t.status}</span>
      <span style="font-size:.68rem;color:var(--dim);flex-shrink:0">${t.sprint}</span>
    </div>`;
  }).join('');
}

// ═══════════════════════════════════════════════════════════════════
//  NAVIGATION
// ═══════════════════════════════════════════════════════════════════

const NAV_MAP = {
  overview:'sec-overview', pipeline:'sec-pipeline', agents:'sec-agents',
  endpoints:'sec-endpoints', testing:'sec-testing', deployment:'sec-deployment',
  data:'sec-data', sprints:'sec-sprints', dashboards:'sec-dashboards', links:'sec-links',
  requirements:'sec-requirements', devstatus:'sec-devstatus', acceptance:'sec-acceptance', devteam:'sec-devteam',
  observability:'sec-observability', internals:'sec-internals', experts:'sec-experts'
};

document.querySelectorAll('.sidebar .nav-item[data-section]').forEach(item => {
  item.addEventListener('click', () => {
    document.querySelectorAll('.sidebar .nav-item').forEach(n=>n.classList.remove('active'));
    item.classList.add('active');
    document.querySelectorAll('.section').forEach(s=>s.classList.remove('active'));
    const sec = document.getElementById(NAV_MAP[item.dataset.section]);
    if(sec) sec.classList.add('active');
  });
});

document.getElementById('btn-refresh').addEventListener('click', fetchHealth);

// ═══════════════════════════════════════════════════════════════════
//  INIT
// ═══════════════════════════════════════════════════════════════════

(function init() {
  renderKPIs();
  renderAgents(LIFECYCLE_AGENTS, 'lifecycle-agents');
  renderAgents(DOMAIN_AGENTS, 'domain-agents');
  renderEndpoints();
  renderCollections();
  renderSprints();
  renderRoles();
  renderLinks();
  renderRequirements();
  renderDevStatus();
  renderAcceptance();
  renderDevTeam();
  renderObservability();
  renderInternals();
  renderExperts();
  fetchHealth();
  // Auto-refresh every 5 minutes
  setInterval(fetchHealth, 300000);
})();
</script>

</body>
</html>
